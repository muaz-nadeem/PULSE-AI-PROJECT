{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/lib/store.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { create } from \"zustand\"\r\n\r\n// Import types from domain layer\r\nimport type {\r\n  Task,\r\n  FocusSession,\r\n  Distraction,\r\n  Challenge,\r\n  Achievement,\r\n  AnalyticsData,\r\n  UserSettings,\r\n  BlockingSettings,\r\n  MoodEntry,\r\n  Habit,\r\n  ScheduleItem,\r\n  AIPlan,\r\n  UserAIProfile,\r\n  TimeBlock,\r\n  SoundPreset,\r\n  Playlist,\r\n  TeamMember,\r\n  SharedGoal,\r\n  GroupChallenge,\r\n  Notification,\r\n  Milestone,\r\n  Goal,\r\n  AuthState,\r\n  DistractionInsights,\r\n} from \"./domain\"\r\n\r\n// Import pure domain functions\r\nimport {\r\n  calculateStreaks,\r\n  toggleHabitCompletion as domainToggleHabitCompletion,\r\n  calculateGoalProgress,\r\n  updateGoalWithMilestones,\r\n  generateGoalSuggestions,\r\n  computeDistractionInsights,\r\n  computeAnalyticsData,\r\n  checkUnlockedAchievements,\r\n  applyUnlockedAchievements,\r\n  computeChallengeProgress,\r\n  computeLeaderboardScore,\r\n  generateSimulatedLeaderboard,\r\n  computeWeeklyStats,\r\n  computeMonthlyStats,\r\n  generateWeeklyReportSummary,\r\n  generateMonthlyReportSummary,\r\n  generateCSVExport,\r\n  DEFAULT_ACHIEVEMENTS,\r\n} from \"./domain\"\r\n\r\n// Re-export types for backward compatibility\r\nexport type {\r\n  Task,\r\n  FocusSession,\r\n  Distraction,\r\n  Challenge,\r\n  Achievement,\r\n  AnalyticsData,\r\n  UserSettings,\r\n  BlockingSettings,\r\n  MoodEntry,\r\n  Habit,\r\n  ScheduleItem,\r\n  AIPlan,\r\n  UserAIProfile,\r\n  TimeBlock,\r\n  SoundPreset,\r\n  Playlist,\r\n  TeamMember,\r\n  SharedGoal,\r\n  GroupChallenge,\r\n  Notification,\r\n  Milestone,\r\n  Goal,\r\n  AuthState,\r\n}\r\n\r\ninterface StoreState {\r\n  // User data\r\n  userName: string\r\n  userGoals: string[]\r\n  userData?: { name?: string; role?: string }\r\n  userPreferences: UserSettings\r\n\r\n  // Navigation\r\n  currentPage: string\r\n  isMobileMenuOpen: boolean\r\n  setMobileMenuOpen: (isOpen: boolean) => void\r\n\r\n  // Tasks\r\n  tasks: Task[]\r\n  addTask: (task: Omit<Task, \"id\" | \"completed\" | \"createdAt\">) => void\r\n  deleteTask: (id: string) => void\r\n  toggleTask: (id: string) => void\r\n  updateTask: (id: string, updates: Partial<Task>) => void\r\n\r\n  // Focus sessions\r\n  focusSessions: FocusSession[]\r\n  addFocusSession: (duration: number) => void\r\n\r\n  // Distractions\r\n  distractions: Distraction[]\r\n  addDistraction: (distraction: Omit<Distraction, \"id\" | \"date\">) => void\r\n  deleteDistraction: (id: string) => void\r\n  getDistractionInsights: () => { topSources: { source: string; count: number }[]; totalTime: number; patterns: string[] }\r\n\r\n  // Challenges\r\n  challenges: Challenge[]\r\n  achievements: Achievement[]\r\n  addChallenge: (challenge: Omit<Challenge, \"id\" | \"current\" | \"completed\">) => void\r\n  updateChallengeProgress: (challengeId: string) => void\r\n  checkAchievements: () => void\r\n  getUnlockedAchievements: () => Achievement[]\r\n  getLeaderboard: () => { userId: string; score: number; rank: number }[]\r\n\r\n  // Analytics\r\n  analytics: AnalyticsData\r\n  getAnalytics: () => AnalyticsData\r\n\r\n  // Settings\r\n  setSettings: (settings: Partial<UserSettings>) => void\r\n  setUserData: (name: string, goals: string[], role?: string) => void\r\n  \r\n  // Blocking Settings\r\n  blockingSettings: BlockingSettings\r\n  setBlockingMode: (mode: \"strict\" | \"standard\" | \"relaxed\") => void\r\n  addBlockedApp: (appName: string) => void\r\n  removeBlockedApp: (appName: string) => void\r\n\r\n  // Page navigation\r\n  setCurrentPage: (page: string) => void\r\n\r\n  // Mood tracking\r\n  moodEntries: MoodEntry[]\r\n  addMoodEntry: (mood: \"excellent\" | \"good\" | \"neutral\" | \"sad\" | \"very-sad\", notes: string) => void\r\n  getMoodHistory: () => MoodEntry[]\r\n\r\n  // Habits\r\n  habits: Habit[]\r\n  addHabit: (habit: Omit<Habit, \"id\" | \"createdAt\" | \"completedDates\" | \"currentStreak\" | \"longestStreak\">) => void\r\n  deleteHabit: (id: string) => void\r\n  toggleHabitCompletion: (habitId: string, date: string) => void\r\n  getHabitStreak: (habitId: string) => number\r\n\r\n  // Goals\r\n  goals: Goal[]\r\n  addGoal: (goal: Omit<Goal, \"id\" | \"createdAt\" | \"progress\" | \"status\">) => void\r\n  deleteGoal: (id: string) => void\r\n  updateGoal: (id: string, updates: Partial<Goal>) => void\r\n  addMilestone: (goalId: string, milestone: Omit<Milestone, \"id\" | \"order\">) => void\r\n  updateMilestone: (goalId: string, milestoneId: string, updates: Partial<Milestone>) => void\r\n  deleteMilestone: (goalId: string, milestoneId: string) => void\r\n  toggleMilestone: (goalId: string, milestoneId: string) => void\r\n  getGoalProgress: (goalId: string) => number\r\n  getAISuggestions: (goalId: string) => string[]\r\n\r\n  // Schedule\r\n  currentSchedule: ScheduleItem[]\r\n  acceptedSchedules: ScheduleItem[][]\r\n  scheduleSyncedFromTimeBlocks: boolean\r\n  setCurrentSchedule: (schedule: ScheduleItem[], fromTimeBlocks?: boolean) => void\r\n  clearTimeBlockSync: () => void\r\n  acceptSchedule: () => void\r\n  getAcceptedSchedules: () => ScheduleItem[][]\r\n\r\n  // Time Blocks\r\n  timeBlocks: TimeBlock[]\r\n  addTimeBlock: (block: Omit<TimeBlock, \"id\">) => void\r\n  updateTimeBlock: (id: string, updates: Partial<TimeBlock>) => void\r\n  deleteTimeBlock: (id: string) => void\r\n  getTimeBlocksForDate: (date: string) => TimeBlock[]\r\n  moveTimeBlock: (id: string, newDate: string, newStartTime: string) => void\r\n\r\n  // Focus Sounds\r\n  soundPresets: SoundPreset[]\r\n  playlists: Playlist[]\r\n  currentPlaylist?: string\r\n  addSoundPreset: (preset: Omit<SoundPreset, \"id\">) => void\r\n  addPlaylist: (playlist: Omit<Playlist, \"id\" | \"createdAt\">) => void\r\n  deletePlaylist: (id: string) => void\r\n  setCurrentPlaylist: (id?: string) => void\r\n\r\n  // Reports\r\n  generateWeeklyReport: () => { summary: string; data: any }\r\n  generateMonthlyReport: () => { summary: string; data: any }\r\n  exportToCSV: () => string\r\n  exportToPDF: () => void\r\n\r\n  // Team/Collaboration\r\n  teamMembers: TeamMember[]\r\n  sharedGoals: SharedGoal[]\r\n  groupChallenges: GroupChallenge[]\r\n  addTeamMember: (member: Omit<TeamMember, \"id\" | \"joinedAt\">) => void\r\n  shareGoal: (goalId: string, memberIds: string[]) => void\r\n  createGroupChallenge: (challenge: Omit<GroupChallenge, \"id\" | \"leaderboard\">) => void\r\n  getTeamProductivityInsights: () => { totalFocusTime: number; totalTasks: number; averageProgress: number }\r\n\r\n  // Notifications\r\n  notifications: Notification[]\r\n  addNotification: (notification: Omit<Notification, \"id\" | \"timestamp\" | \"read\">) => void\r\n  markNotificationRead: (id: string) => void\r\n  clearNotifications: () => void\r\n  getUnreadNotifications: () => Notification[]\r\n  checkSmartNotifications: () => void\r\n\r\n  // Voice Commands\r\n  isVoiceActive: boolean\r\n  setVoiceActive: (active: boolean) => void\r\n  processVoiceCommand: (command: string) => void\r\n\r\n  auth: AuthState\r\n  setAuth: (isAuthenticated: boolean, userEmail?: string) => void\r\n  logout: () => void\r\n\r\n  // AI Features\r\n  currentAIPlan: AIPlan | null\r\n  userAIProfile: UserAIProfile | null\r\n  aiPlanLoading: boolean\r\n  aiPlanError: string | null\r\n  setCurrentAIPlan: (plan: AIPlan | null) => void\r\n  setUserAIProfile: (profile: UserAIProfile | null) => void\r\n  setAIPlanLoading: (loading: boolean) => void\r\n  setAIPlanError: (error: string | null) => void\r\n  acceptAIPlan: () => void\r\n  rejectAIPlan: () => void\r\n}\r\n\r\nexport const useStore = create<StoreState>((set, get) => ({\r\n  userName: \"\",\r\n  userGoals: [],\r\n  userData: undefined,\r\n  userPreferences: {\r\n    focusDuration: 25,\r\n    breakDuration: 5,\r\n    dailyGoal: 8,\r\n    theme: \"dark\",\r\n    soundEnabled: true,\r\n  },\r\n\r\n  currentPage: \"dashboard\",\r\n  isMobileMenuOpen: false,\r\n  setMobileMenuOpen: (isOpen) => set({ isMobileMenuOpen: isOpen }),\r\n  blockingSettings: {\r\n    blockingMode: \"standard\",\r\n    blockedApps: [\"Instagram\", \"TikTok\", \"YouTube\"],\r\n  },\r\n  setBlockingMode: (mode) =>\r\n    set((state) => ({\r\n      blockingSettings: { ...state.blockingSettings, blockingMode: mode },\r\n    })),\r\n  addBlockedApp: (appName) =>\r\n    set((state) => ({\r\n      blockingSettings: {\r\n        ...state.blockingSettings,\r\n        blockedApps: [...state.blockingSettings.blockedApps, appName],\r\n      },\r\n    })),\r\n  removeBlockedApp: (appName) =>\r\n    set((state) => ({\r\n      blockingSettings: {\r\n        ...state.blockingSettings,\r\n        blockedApps: state.blockingSettings.blockedApps.filter((app) => app !== appName),\r\n      },\r\n    })),\r\n  tasks: [],\r\n  focusSessions: [],\r\n  distractions: [],\r\n  challenges: [],\r\n  achievements: [\r\n    {\r\n      id: \"first_focus\",\r\n      title: \"First Focus\",\r\n      description: \"Complete your first focus session\",\r\n      icon: \"ðŸŽ¯\",\r\n      category: \"focus\",\r\n    },\r\n    {\r\n      id: \"focus_master\",\r\n      title: \"Focus Master\",\r\n      description: \"Complete 10 focus sessions\",\r\n      icon: \"ðŸ”¥\",\r\n      category: \"focus\",\r\n    },\r\n    {\r\n      id: \"task_warrior\",\r\n      title: \"Task Warrior\",\r\n      description: \"Complete 50 tasks\",\r\n      icon: \"âš”ï¸\",\r\n      category: \"tasks\",\r\n    },\r\n    {\r\n      id: \"habit_hero\",\r\n      title: \"Habit Hero\",\r\n      description: \"Maintain a 7-day streak on any habit\",\r\n      icon: \"ðŸ’ª\",\r\n      category: \"habits\",\r\n    },\r\n    {\r\n      id: \"goal_getter\",\r\n      title: \"Goal Getter\",\r\n      description: \"Complete your first goal\",\r\n      icon: \"ðŸ†\",\r\n      category: \"goals\",\r\n    },\r\n    {\r\n      id: \"streak_king\",\r\n      title: \"Streak King\",\r\n      description: \"Maintain a 30-day focus streak\",\r\n      icon: \"ðŸ‘‘\",\r\n      category: \"streaks\",\r\n    },\r\n    {\r\n      id: \"milestone_master\",\r\n      title: \"Milestone Master\",\r\n      description: \"Complete 10 milestones\",\r\n      icon: \"â­\",\r\n      category: \"milestones\",\r\n    },\r\n  ],\r\n  analytics: {\r\n    totalFocusHours: 0,\r\n    totalFocusTime: 0,\r\n    tasksCompletedToday: 0,\r\n    tasksCompletedThisWeek: 0,\r\n    averageFocusTime: 0,\r\n    streakDays: 0,\r\n    tasksCompleted: 0,\r\n    focusSessions: [],\r\n  },\r\n  moodEntries: [],\r\n  habits: [],\r\n  goals: [],\r\n  currentSchedule: [],\r\n  acceptedSchedules: [],\r\n  scheduleSyncedFromTimeBlocks: false,\r\n  timeBlocks: [],\r\n  soundPresets: [\r\n    {\r\n      id: \"white_noise_1\",\r\n      name: \"White Noise\",\r\n      type: \"white_noise\",\r\n      icon: \"ðŸŒŠ\",\r\n    },\r\n    {\r\n      id: \"rain_1\",\r\n      name: \"Rain\",\r\n      type: \"nature\",\r\n      icon: \"ðŸŒ§ï¸\",\r\n    },\r\n    {\r\n      id: \"forest_1\",\r\n      name: \"Forest\",\r\n      type: \"nature\",\r\n      icon: \"ðŸŒ²\",\r\n    },\r\n    {\r\n      id: \"coffee_1\",\r\n      name: \"Coffee Shop\",\r\n      type: \"ambient\",\r\n      icon: \"â˜•\",\r\n    },\r\n    {\r\n      id: \"ocean_1\",\r\n      name: \"Ocean Waves\",\r\n      type: \"nature\",\r\n      icon: \"ðŸŒŠ\",\r\n    },\r\n    {\r\n      id: \"focus_1\",\r\n      name: \"Deep Focus\",\r\n      type: \"focus\",\r\n      icon: \"ðŸŽµ\",\r\n    },\r\n  ],\r\n  playlists: [],\r\n  currentPlaylist: undefined,\r\n  teamMembers: [],\r\n  sharedGoals: [],\r\n  groupChallenges: [],\r\n  notifications: [],\r\n  isVoiceActive: false,\r\n\r\n  auth: {\r\n    isAuthenticated: false,\r\n    userEmail: \"\",\r\n  },\r\n\r\n  // AI Features - Initial State\r\n  currentAIPlan: null,\r\n  userAIProfile: null,\r\n  aiPlanLoading: false,\r\n  aiPlanError: null,\r\n\r\n  addTask: async (task) => {\r\n    try {\r\n      const api = await import(\"./api\")\r\n      // Prepare data for API - only send snake_case fields\r\n      const apiData: any = {\r\n        title: task.title,\r\n        description: task.description || \"\",\r\n        priority: task.priority,\r\n        time_estimate: task.timeEstimate,\r\n        category: task.category,\r\n        focus_mode: task.focusMode || false,\r\n      }\r\n      \r\n      // Convert dueDate to ISO string if provided\r\n      if (task.dueDate) {\r\n        // If it's already a string in YYYY-MM-DD format, convert to ISO datetime\r\n        const dueDate = new Date(task.dueDate)\r\n        if (!isNaN(dueDate.getTime())) {\r\n          apiData.due_date = dueDate.toISOString()\r\n        }\r\n      }\r\n      \r\n      const created = (await api.tasksAPI.create(apiData)) as any\r\n      \r\n      // Add to store with proper field mapping\r\n      set((state) => ({\r\n        tasks: [\r\n          ...state.tasks,\r\n          {\r\n            id: created.id,\r\n            title: created.title,\r\n            description: created.description || \"\",\r\n            priority: created.priority,\r\n            timeEstimate: created.time_estimate || 30,\r\n            completed: created.completed || false,\r\n            createdAt: new Date(created.created_at),\r\n            category: created.category,\r\n            dueDate: created.due_date ? new Date(created.due_date).toISOString().split(\"T\")[0] : undefined,\r\n            focusMode: created.focus_mode || false,\r\n          },\r\n        ],\r\n      }))\r\n    } catch (error) {\r\n      console.error(\"Failed to create task in API:\", error)\r\n      // Still add to local state as fallback, but log the error\r\n      set((state) => {\r\n        const newTask = {\r\n          ...task,\r\n          id: Math.random().toString(36).substring(7),\r\n          completed: false,\r\n          createdAt: new Date(),\r\n        }\r\n        return {\r\n          tasks: [...state.tasks, newTask],\r\n        }\r\n      })\r\n    }\r\n  },\r\n\r\n  deleteTask: async (id) => {\r\n    try {\r\n      const api = await import(\"./api\")\r\n      await api.tasksAPI.delete(id)\r\n    } catch (error) {\r\n      console.error(\"Failed to delete task from API:\", error)\r\n    }\r\n    set((state) => ({\r\n      tasks: state.tasks.filter((t) => t.id !== id),\r\n    }))\r\n  },\r\n\r\n  toggleTask: async (id) => {\r\n    const state = get()\r\n    const task = state.tasks.find((t) => t.id === id)\r\n    if (task) {\r\n      try {\r\n        const api = await import(\"./api\")\r\n        await api.tasksAPI.update(id, { completed: !task.completed })\r\n      } catch (error) {\r\n        console.error(\"Failed to update task in API:\", error)\r\n      }\r\n    }\r\n    set((state) => ({\r\n      tasks: state.tasks.map((t) => (t.id === id ? { ...t, completed: !t.completed } : t)),\r\n    }))\r\n  },\r\n\r\n  updateTask: async (id, updates) => {\r\n    try {\r\n      const api = await import(\"./api\")\r\n      const apiUpdates: any = {}\r\n      if (updates.timeEstimate !== undefined) apiUpdates.time_estimate = updates.timeEstimate\r\n      if (updates.dueDate !== undefined) apiUpdates.due_date = updates.dueDate\r\n      if (updates.focusMode !== undefined) apiUpdates.focus_mode = updates.focusMode\r\n      if (updates.completed !== undefined) apiUpdates.completed = updates.completed\r\n      if (updates.title !== undefined) apiUpdates.title = updates.title\r\n      if (updates.description !== undefined) apiUpdates.description = updates.description\r\n      if (updates.priority !== undefined) apiUpdates.priority = updates.priority\r\n      if (updates.category !== undefined) apiUpdates.category = updates.category\r\n      \r\n      await api.tasksAPI.update(id, apiUpdates)\r\n    } catch (error) {\r\n      console.error(\"Failed to update task in API:\", error)\r\n    }\r\n    set((state) => ({\r\n      tasks: state.tasks.map((t) => (t.id === id ? { ...t, ...updates } : t)),\r\n    }))\r\n  },\r\n\r\n  addFocusSession: async (duration) => {\r\n    try {\r\n      const api = await import(\"./api\")\r\n      await api.focusSessionsAPI.create({ duration, completed: true })\r\n    } catch (error) {\r\n      console.error(\"Failed to create focus session in API:\", error)\r\n    }\r\n    \r\n    set((state) => {\r\n      const newSession: FocusSession = {\r\n        id: Math.random().toString(36).substring(7),\r\n        duration,\r\n        date: new Date(),\r\n        completed: true,\r\n      }\r\n\r\n      const updatedSessions = [...state.focusSessions, newSession]\r\n\r\n      const today = new Date()\r\n      today.setHours(0, 0, 0, 0)\r\n\r\n      const todaySessions = updatedSessions.filter((s) => {\r\n        const sessionDate = new Date(s.date)\r\n        sessionDate.setHours(0, 0, 0, 0)\r\n        return sessionDate.getTime() === today.getTime()\r\n      })\r\n\r\n      const thisWeekStart = new Date(today)\r\n      thisWeekStart.setDate(today.getDate() - today.getDay())\r\n\r\n      const weekTasks = state.tasks.filter((t) => {\r\n        const taskDate = new Date(t.createdAt)\r\n        taskDate.setHours(0, 0, 0, 0)\r\n        return taskDate >= thisWeekStart && t.completed\r\n      })\r\n\r\n      const totalFocusMinutes = updatedSessions.reduce((sum, s) => sum + s.duration, 0)\r\n      const totalFocusHours = Math.round((totalFocusMinutes / 60) * 10) / 10\r\n      const averageFocusTime =\r\n        updatedSessions.length > 0 ? Math.round((totalFocusMinutes / updatedSessions.length) * 10) / 10 : 0\r\n\r\n      const todayCompleted = state.tasks.filter((t) => {\r\n        const taskDate = new Date(t.createdAt)\r\n        taskDate.setHours(0, 0, 0, 0)\r\n        return taskDate.getTime() === today.getTime() && t.completed\r\n      }).length\r\n\r\n      return {\r\n        focusSessions: updatedSessions,\r\n        analytics: {\r\n          totalFocusHours,\r\n          totalFocusTime: totalFocusHours,\r\n          tasksCompletedToday: todayCompleted,\r\n          tasksCompletedThisWeek: weekTasks.length,\r\n          averageFocusTime,\r\n          streakDays: updatedSessions.length > 0 ? Math.min(updatedSessions.length, 30) : 0,\r\n          tasksCompleted: state.tasks.filter((t) => t.completed).length,\r\n          focusSessions: updatedSessions,\r\n        },\r\n      }\r\n    })\r\n  },\r\n\r\n  getAnalytics: () => {\r\n    const state = get()\r\n    return state.analytics\r\n  },\r\n\r\n  setSettings: (settings) =>\r\n    set((state) => ({\r\n      userPreferences: { ...state.userPreferences, ...settings },\r\n    })),\r\n\r\n  setUserData: (name, goals, role) =>\r\n    set({\r\n      userName: name,\r\n      userGoals: goals,\r\n      userData: { name, role },\r\n    }),\r\n\r\n  setCurrentPage: (page) => set({ currentPage: page }),\r\n\r\n  addMoodEntry: (mood, notes) =>\r\n    set((state) => {\r\n      const newEntry: MoodEntry = {\r\n        id: Math.random().toString(36).substring(7),\r\n        mood,\r\n        notes,\r\n        date: new Date(),\r\n      }\r\n      return {\r\n        moodEntries: [...state.moodEntries, newEntry],\r\n      }\r\n    }),\r\n\r\n  getMoodHistory: () => {\r\n    const state = get()\r\n    return state.moodEntries\r\n  },\r\n\r\n  addHabit: (habit) =>\r\n    set((state) => {\r\n      const newHabit: Habit = {\r\n        ...habit,\r\n        id: Math.random().toString(36).substring(7),\r\n        createdAt: new Date(),\r\n        completedDates: [],\r\n        currentStreak: 0,\r\n        longestStreak: 0,\r\n      }\r\n      return {\r\n        habits: [...state.habits, newHabit],\r\n      }\r\n    }),\r\n\r\n  deleteHabit: (id) =>\r\n    set((state) => ({\r\n      habits: state.habits.filter((h) => h.id !== id),\r\n    })),\r\n\r\n  toggleHabitCompletion: (habitId, date) =>\r\n    set((state) => {\r\n      const habit = state.habits.find((h) => h.id === habitId)\r\n      if (!habit) return state\r\n\r\n      const dateStr = date\r\n      const isCompleted = habit.completedDates.includes(dateStr)\r\n      const newCompletedDates = isCompleted\r\n        ? habit.completedDates.filter((d) => d !== dateStr)\r\n        : [...habit.completedDates, dateStr].sort()\r\n\r\n      // Calculate streaks\r\n      const today = new Date()\r\n      today.setHours(0, 0, 0, 0)\r\n      const todayStr = today.toISOString().split(\"T\")[0]\r\n\r\n      let currentStreak = 0\r\n      let longestStreak = habit.longestStreak\r\n\r\n      if (newCompletedDates.length > 0) {\r\n        // Calculate current streak\r\n        const sortedDates = [...newCompletedDates].sort().reverse()\r\n        let checkDate = new Date(today)\r\n        \r\n        for (const dateStr of sortedDates) {\r\n          const checkDateStr = checkDate.toISOString().split(\"T\")[0]\r\n          if (dateStr === checkDateStr) {\r\n            currentStreak++\r\n            checkDate.setDate(checkDate.getDate() - 1)\r\n          } else {\r\n            break\r\n          }\r\n        }\r\n\r\n        // Calculate longest streak\r\n        let tempStreak = 0\r\n        let prevDate: Date | null = null\r\n        for (const dateStr of sortedDates) {\r\n          const currentDate = new Date(dateStr)\r\n          if (prevDate === null) {\r\n            tempStreak = 1\r\n          } else {\r\n            const diffDays = Math.floor((prevDate.getTime() - currentDate.getTime()) / (1000 * 60 * 60 * 24))\r\n            if (diffDays === 1) {\r\n              tempStreak++\r\n            } else {\r\n              longestStreak = Math.max(longestStreak, tempStreak)\r\n              tempStreak = 1\r\n            }\r\n          }\r\n          prevDate = currentDate\r\n        }\r\n        longestStreak = Math.max(longestStreak, tempStreak)\r\n      }\r\n\r\n      return {\r\n        habits: state.habits.map((h) =>\r\n          h.id === habitId\r\n            ? {\r\n                ...h,\r\n                completedDates: newCompletedDates,\r\n                currentStreak,\r\n                longestStreak,\r\n              }\r\n            : h\r\n        ),\r\n      }\r\n    }),\r\n\r\n  getHabitStreak: (habitId) => {\r\n    const state = get()\r\n    const habit = state.habits.find((h) => h.id === habitId)\r\n    return habit?.currentStreak || 0\r\n  },\r\n\r\n  addGoal: (goal) =>\r\n    set((state) => {\r\n      const newGoal: Goal = {\r\n        ...goal,\r\n        id: Math.random().toString(36).substring(7),\r\n        createdAt: new Date(),\r\n        progress: 0,\r\n        status: \"active\",\r\n        milestones: goal.milestones || [],\r\n      }\r\n      return {\r\n        goals: [...state.goals, newGoal],\r\n      }\r\n    }),\r\n\r\n  deleteGoal: (id) =>\r\n    set((state) => ({\r\n      goals: state.goals.filter((g) => g.id !== id),\r\n    })),\r\n\r\n  updateGoal: (id, updates) =>\r\n    set((state) => {\r\n      const goal = state.goals.find((g) => g.id === id)\r\n      if (!goal) return state\r\n\r\n      const updatedGoal = { ...goal, ...updates }\r\n      \r\n      // Recalculate progress if milestones changed\r\n      if (updates.milestones !== undefined) {\r\n        const completedMilestones = updatedGoal.milestones.filter((m) => m.completed).length\r\n        updatedGoal.progress =\r\n          updatedGoal.milestones.length > 0\r\n            ? Math.round((completedMilestones / updatedGoal.milestones.length) * 100)\r\n            : 0\r\n\r\n        // Auto-update status if all milestones completed\r\n        if (updatedGoal.progress === 100 && updatedGoal.status === \"active\") {\r\n          updatedGoal.status = \"completed\"\r\n        }\r\n      }\r\n\r\n      return {\r\n        goals: state.goals.map((g) => (g.id === id ? updatedGoal : g)),\r\n      }\r\n    }),\r\n\r\n  addMilestone: (goalId, milestone) =>\r\n    set((state) => {\r\n      const goal = state.goals.find((g) => g.id === goalId)\r\n      if (!goal) return state\r\n\r\n      const maxOrder = goal.milestones.length > 0 ? Math.max(...goal.milestones.map((m) => m.order)) : -1\r\n      const newMilestone: Milestone = {\r\n        ...milestone,\r\n        id: Math.random().toString(36).substring(7),\r\n        order: maxOrder + 1,\r\n      }\r\n\r\n      const updatedMilestones = [...goal.milestones, newMilestone].sort((a, b) => a.order - b.order)\r\n      const completedMilestones = updatedMilestones.filter((m) => m.completed).length\r\n      const progress = updatedMilestones.length > 0 ? Math.round((completedMilestones / updatedMilestones.length) * 100) : 0\r\n\r\n      return {\r\n        goals: state.goals.map((g) =>\r\n          g.id === goalId\r\n            ? {\r\n                ...g,\r\n                milestones: updatedMilestones,\r\n                progress,\r\n                status: progress === 100 && g.status === \"active\" ? \"completed\" : g.status,\r\n              }\r\n            : g\r\n        ),\r\n      }\r\n    }),\r\n\r\n  updateMilestone: (goalId, milestoneId, updates) =>\r\n    set((state) => {\r\n      const goal = state.goals.find((g) => g.id === goalId)\r\n      if (!goal) return state\r\n\r\n      const updatedMilestones = goal.milestones.map((m) =>\r\n        m.id === milestoneId ? { ...m, ...updates } : m\r\n      )\r\n      const completedMilestones = updatedMilestones.filter((m) => m.completed).length\r\n      const progress = updatedMilestones.length > 0 ? Math.round((completedMilestones / updatedMilestones.length) * 100) : 0\r\n\r\n      return {\r\n        goals: state.goals.map((g) =>\r\n          g.id === goalId\r\n            ? {\r\n                ...g,\r\n                milestones: updatedMilestones,\r\n                progress,\r\n                status: progress === 100 && g.status === \"active\" ? \"completed\" : g.status,\r\n              }\r\n            : g\r\n        ),\r\n      }\r\n    }),\r\n\r\n  deleteMilestone: (goalId, milestoneId) =>\r\n    set((state) => {\r\n      const goal = state.goals.find((g) => g.id === goalId)\r\n      if (!goal) return state\r\n\r\n      const updatedMilestones = goal.milestones.filter((m) => m.id !== milestoneId)\r\n      const completedMilestones = updatedMilestones.filter((m) => m.completed).length\r\n      const progress = updatedMilestones.length > 0 ? Math.round((completedMilestones / updatedMilestones.length) * 100) : 0\r\n\r\n      return {\r\n        goals: state.goals.map((g) =>\r\n          g.id === goalId\r\n            ? {\r\n                ...g,\r\n                milestones: updatedMilestones,\r\n                progress,\r\n              }\r\n            : g\r\n        ),\r\n      }\r\n    }),\r\n\r\n  toggleMilestone: (goalId, milestoneId) =>\r\n    set((state) => {\r\n      const goal = state.goals.find((g) => g.id === goalId)\r\n      if (!goal) return state\r\n\r\n      const updatedMilestones = goal.milestones.map((m) => {\r\n        if (m.id === milestoneId) {\r\n          const today = new Date().toISOString().split(\"T\")[0]\r\n          return {\r\n            ...m,\r\n            completed: !m.completed,\r\n            completedDate: !m.completed ? today : undefined,\r\n          }\r\n        }\r\n        return m\r\n      })\r\n\r\n      const completedMilestones = updatedMilestones.filter((m) => m.completed).length\r\n      const progress = updatedMilestones.length > 0 ? Math.round((completedMilestones / updatedMilestones.length) * 100) : 0\r\n\r\n      return {\r\n        goals: state.goals.map((g) =>\r\n          g.id === goalId\r\n            ? {\r\n                ...g,\r\n                milestones: updatedMilestones,\r\n                progress,\r\n                status: progress === 100 && g.status === \"active\" ? \"completed\" : g.status,\r\n              }\r\n            : g\r\n        ),\r\n      }\r\n    }),\r\n\r\n  getGoalProgress: (goalId) => {\r\n    const state = get()\r\n    const goal = state.goals.find((g) => g.id === goalId)\r\n    return goal?.progress || 0\r\n  },\r\n\r\n  getAISuggestions: (goalId) => {\r\n    const state = get()\r\n    const goal = state.goals.find((g) => g.id === goalId)\r\n    if (!goal) return []\r\n\r\n    const suggestions: string[] = []\r\n    const completedMilestones = goal.milestones.filter((m) => m.completed).length\r\n    const totalMilestones = goal.milestones.length\r\n    const progress = goal.progress\r\n\r\n    // Progress-based suggestions\r\n    if (progress === 0) {\r\n      suggestions.push(\"Start by completing your first milestone to build momentum!\")\r\n      suggestions.push(\"Break down your first milestone into smaller daily tasks.\")\r\n    } else if (progress < 30) {\r\n      suggestions.push(\"You're just getting started! Focus on completing 1-2 milestones this week.\")\r\n      suggestions.push(\"Consider scheduling specific times for goal-related tasks.\")\r\n    } else if (progress < 50) {\r\n      suggestions.push(\"Great progress! You're almost halfway there. Keep the momentum going!\")\r\n      suggestions.push(\"Review your upcoming milestones and plan ahead.\")\r\n    } else if (progress < 80) {\r\n      suggestions.push(\"You're making excellent progress! Focus on the remaining milestones.\")\r\n      suggestions.push(\"Consider celebrating your progress so far to stay motivated.\")\r\n    } else if (progress < 100) {\r\n      suggestions.push(\"You're so close! Push through the final milestones to achieve your goal.\")\r\n      suggestions.push(\"Review what's worked well and apply it to the remaining tasks.\")\r\n    }\r\n\r\n    // Task integration suggestions\r\n    const relatedTasks = state.tasks.filter((t) => \r\n      t.title.toLowerCase().includes(goal.title.toLowerCase().split(\" \")[0].toLowerCase()) ||\r\n      goal.title.toLowerCase().includes(t.title.toLowerCase().split(\" \")[0].toLowerCase())\r\n    )\r\n    if (relatedTasks.length === 0) {\r\n      suggestions.push(\"Create tasks related to this goal to track daily progress.\")\r\n    } else {\r\n      const incompleteTasks = relatedTasks.filter((t) => !t.completed)\r\n      if (incompleteTasks.length > 0) {\r\n        suggestions.push(`You have ${incompleteTasks.length} related tasks. Complete them to advance your goal.`)\r\n      }\r\n    }\r\n\r\n    // Time-based suggestions\r\n    if (goal.targetDate) {\r\n      const targetDate = new Date(goal.targetDate)\r\n      const today = new Date()\r\n      const daysRemaining = Math.ceil((targetDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\r\n      const milestonesRemaining = totalMilestones - completedMilestones\r\n      \r\n      if (daysRemaining > 0 && milestonesRemaining > 0) {\r\n        const dailyMilestoneRate = milestonesRemaining / daysRemaining\r\n        if (dailyMilestoneRate > 0.5) {\r\n          suggestions.push(`You have ${daysRemaining} days left. Complete ${Math.ceil(dailyMilestoneRate)} milestone(s) per day to stay on track.`)\r\n        }\r\n      }\r\n    }\r\n\r\n    return suggestions.slice(0, 3) // Return top 3 suggestions\r\n  },\r\n\r\n  addDistraction: (distraction) =>\r\n    set((state) => {\r\n      const newDistraction: Distraction = {\r\n        ...distraction,\r\n        id: Math.random().toString(36).substring(7),\r\n        date: new Date(),\r\n      }\r\n      return {\r\n        distractions: [...state.distractions, newDistraction],\r\n      }\r\n    }),\r\n\r\n  deleteDistraction: (id) =>\r\n    set((state) => ({\r\n      distractions: state.distractions.filter((d) => d.id !== id),\r\n    })),\r\n\r\n  getDistractionInsights: () => {\r\n    const state = get()\r\n    const distractions = state.distractions\r\n\r\n    // Get top sources\r\n    const sourceCounts: Record<string, number> = {}\r\n    distractions.forEach((d) => {\r\n      sourceCounts[d.source] = (sourceCounts[d.source] || 0) + 1\r\n    })\r\n\r\n    const topSources = Object.entries(sourceCounts)\r\n      .map(([source, count]) => ({ source, count }))\r\n      .sort((a, b) => b.count - a.count)\r\n      .slice(0, 5)\r\n\r\n    // Calculate total time lost\r\n    const totalTime = distractions.reduce((sum, d) => sum + d.duration, 0)\r\n\r\n    // Generate patterns/insights\r\n    const patterns: string[] = []\r\n    const typeCounts: Record<string, number> = {}\r\n    distractions.forEach((d) => {\r\n      typeCounts[d.type] = (typeCounts[d.type] || 0) + 1\r\n    })\r\n\r\n    const mostCommonType = Object.entries(typeCounts).sort((a, b) => b[1] - a[1])[0]\r\n    if (mostCommonType) {\r\n      patterns.push(`Most common distraction type: ${mostCommonType[0]} (${mostCommonType[1]} times)`)\r\n    }\r\n\r\n    const avgDuration = distractions.length > 0 ? totalTime / distractions.length : 0\r\n    if (avgDuration > 10) {\r\n      patterns.push(`Average distraction duration is ${Math.round(avgDuration)} minutes - consider shorter breaks`)\r\n    }\r\n\r\n    if (topSources.length > 0) {\r\n      patterns.push(`Top distraction source: ${topSources[0].source} (${topSources[0].count} times)`)\r\n    }\r\n\r\n    const today = new Date()\r\n    today.setHours(0, 0, 0, 0)\r\n    const todayDistractions = distractions.filter((d) => {\r\n      const dDate = new Date(d.date)\r\n      dDate.setHours(0, 0, 0, 0)\r\n      return dDate.getTime() === today.getTime()\r\n    })\r\n    if (todayDistractions.length > 5) {\r\n      patterns.push(`You've had ${todayDistractions.length} distractions today - consider using blocking mode`)\r\n    }\r\n\r\n    return { topSources, totalTime, patterns }\r\n  },\r\n\r\n  addChallenge: (challenge) =>\r\n    set((state) => {\r\n      const newChallenge: Challenge = {\r\n        ...challenge,\r\n        id: Math.random().toString(36).substring(7),\r\n        current: 0,\r\n        completed: false,\r\n      }\r\n      return {\r\n        challenges: [...state.challenges, newChallenge],\r\n      }\r\n    }),\r\n\r\n  updateChallengeProgress: (challengeId) =>\r\n    set((state) => {\r\n      const challenge = state.challenges.find((c) => c.id === challengeId)\r\n      if (!challenge) return state\r\n\r\n      let current = 0\r\n      const today = new Date()\r\n      today.setHours(0, 0, 0, 0)\r\n\r\n      switch (challenge.metric) {\r\n        case \"focus_sessions\":\r\n          const sessionsInPeriod = state.focusSessions.filter((s) => {\r\n            const sessionDate = new Date(s.date)\r\n            sessionDate.setHours(0, 0, 0, 0)\r\n            return sessionDate >= challenge.startDate && sessionDate <= challenge.endDate\r\n          })\r\n          current = sessionsInPeriod.length\r\n          break\r\n        case \"tasks_completed\":\r\n          const tasksInPeriod = state.tasks.filter((t) => {\r\n            if (!t.completed) return false\r\n            const taskDate = new Date(t.createdAt)\r\n            taskDate.setHours(0, 0, 0, 0)\r\n            return taskDate >= challenge.startDate && taskDate <= challenge.endDate\r\n          })\r\n          current = tasksInPeriod.length\r\n          break\r\n        case \"habits_streak\":\r\n          const maxStreak = Math.max(...state.habits.map((h) => h.currentStreak), 0)\r\n          current = maxStreak\r\n          break\r\n        case \"goals_progress\":\r\n          const totalProgress = state.goals.reduce((sum, g) => sum + g.progress, 0)\r\n          current = Math.round(totalProgress / (state.goals.length || 1))\r\n          break\r\n      }\r\n\r\n      const completed = current >= challenge.target\r\n\r\n      return {\r\n        challenges: state.challenges.map((c) =>\r\n          c.id === challengeId\r\n            ? {\r\n                ...c,\r\n                current,\r\n                completed,\r\n              }\r\n            : c\r\n        ),\r\n      }\r\n    }),\r\n\r\n  checkAchievements: () =>\r\n    set((state) => {\r\n      const unlocked: Achievement[] = []\r\n\r\n      // Check focus achievements\r\n      if (state.focusSessions.length >= 1) {\r\n        const achievement = state.achievements.find((a) => a.id === \"first_focus\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n      if (state.focusSessions.length >= 10) {\r\n        const achievement = state.achievements.find((a) => a.id === \"focus_master\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      // Check task achievements\r\n      const completedTasks = state.tasks.filter((t) => t.completed).length\r\n      if (completedTasks >= 50) {\r\n        const achievement = state.achievements.find((a) => a.id === \"task_warrior\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      // Check habit achievements\r\n      const maxStreak = Math.max(...state.habits.map((h) => h.currentStreak), 0)\r\n      if (maxStreak >= 7) {\r\n        const achievement = state.achievements.find((a) => a.id === \"habit_hero\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      // Check goal achievements\r\n      const completedGoals = state.goals.filter((g) => g.status === \"completed\").length\r\n      if (completedGoals >= 1) {\r\n        const achievement = state.achievements.find((a) => a.id === \"goal_getter\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      // Check streak achievements\r\n      if (state.analytics.streakDays >= 30) {\r\n        const achievement = state.achievements.find((a) => a.id === \"streak_king\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      // Check milestone achievements\r\n      const totalMilestones = state.goals.reduce((sum, g) => {\r\n        return sum + g.milestones.filter((m) => m.completed).length\r\n      }, 0)\r\n      if (totalMilestones >= 10) {\r\n        const achievement = state.achievements.find((a) => a.id === \"milestone_master\" && !a.unlockedAt)\r\n        if (achievement) {\r\n          unlocked.push({ ...achievement, unlockedAt: new Date() })\r\n        }\r\n      }\r\n\r\n      if (unlocked.length > 0) {\r\n        return {\r\n          achievements: state.achievements.map((a) => {\r\n            const unlockedAchievement = unlocked.find((u) => u.id === a.id)\r\n            return unlockedAchievement || a\r\n          }),\r\n        }\r\n      }\r\n\r\n      return state\r\n    }),\r\n\r\n  getUnlockedAchievements: () => {\r\n    const state = get()\r\n    return state.achievements.filter((a) => a.unlockedAt !== undefined)\r\n  },\r\n\r\n  getLeaderboard: () => {\r\n    const state = get()\r\n    // Simulated leaderboard - in real app, this would come from backend\r\n    const score =\r\n      state.focusSessions.length * 10 +\r\n      state.tasks.filter((t) => t.completed).length * 5 +\r\n      state.habits.reduce((sum, h) => sum + h.currentStreak, 0) * 3 +\r\n      state.goals.filter((g) => g.status === \"completed\").length * 50\r\n\r\n    return [\r\n      { userId: \"you\", score, rank: 1 },\r\n      { userId: \"user2\", score: score - 50, rank: 2 },\r\n      { userId: \"user3\", score: score - 100, rank: 3 },\r\n    ]\r\n  },\r\n\r\n  setCurrentSchedule: (schedule, fromTimeBlocks = false) =>\r\n    set({\r\n      currentSchedule: schedule,\r\n      scheduleSyncedFromTimeBlocks: fromTimeBlocks,\r\n    }),\r\n\r\n  clearTimeBlockSync: () =>\r\n    set({\r\n      scheduleSyncedFromTimeBlocks: false,\r\n    }),\r\n\r\n  acceptSchedule: () =>\r\n    set((state) => ({\r\n      acceptedSchedules: [...state.acceptedSchedules, state.currentSchedule],\r\n    })),\r\n\r\n  getAcceptedSchedules: () => {\r\n    const state = get()\r\n    return state.acceptedSchedules\r\n  },\r\n\r\n  addTimeBlock: (block) =>\r\n    set((state) => {\r\n      const newBlock: TimeBlock = {\r\n        ...block,\r\n        id: Math.random().toString(36).substring(7),\r\n      }\r\n      return {\r\n        timeBlocks: [...state.timeBlocks, newBlock],\r\n      }\r\n    }),\r\n\r\n  updateTimeBlock: (id, updates) =>\r\n    set((state) => ({\r\n      timeBlocks: state.timeBlocks.map((b) => (b.id === id ? { ...b, ...updates } : b)),\r\n    })),\r\n\r\n  deleteTimeBlock: (id) =>\r\n    set((state) => ({\r\n      timeBlocks: state.timeBlocks.filter((b) => b.id !== id),\r\n    })),\r\n\r\n  getTimeBlocksForDate: (date) => {\r\n    const state = get()\r\n    return state.timeBlocks.filter((b) => b.date === date).sort((a, b) => a.startTime.localeCompare(b.startTime))\r\n  },\r\n\r\n  moveTimeBlock: (id, newDate, newStartTime) =>\r\n    set((state) => {\r\n      const block = state.timeBlocks.find((b) => b.id === id)\r\n      if (!block) return state\r\n\r\n      const startMinutes = parseInt(newStartTime.split(\":\")[0]) * 60 + parseInt(newStartTime.split(\":\")[1])\r\n      const endMinutes = parseInt(block.endTime.split(\":\")[0]) * 60 + parseInt(block.endTime.split(\":\")[1])\r\n      const duration = endMinutes - (parseInt(block.startTime.split(\":\")[0]) * 60 + parseInt(block.startTime.split(\":\")[1]))\r\n      const newEndMinutes = startMinutes + duration\r\n      const newEndTime = `${Math.floor(newEndMinutes / 60).toString().padStart(2, \"0\")}:${(newEndMinutes % 60).toString().padStart(2, \"0\")}`\r\n\r\n      return {\r\n        timeBlocks: state.timeBlocks.map((b) =>\r\n          b.id === id\r\n            ? {\r\n                ...b,\r\n                date: newDate,\r\n                startTime: newStartTime,\r\n                endTime: newEndTime,\r\n              }\r\n            : b\r\n        ),\r\n      }\r\n    }),\r\n\r\n  addSoundPreset: (preset) =>\r\n    set((state) => {\r\n      const newPreset: SoundPreset = {\r\n        ...preset,\r\n        id: Math.random().toString(36).substring(7),\r\n      }\r\n      return {\r\n        soundPresets: [...state.soundPresets, newPreset],\r\n      }\r\n    }),\r\n\r\n  addPlaylist: (playlist) =>\r\n    set((state) => {\r\n      const newPlaylist: Playlist = {\r\n        ...playlist,\r\n        id: Math.random().toString(36).substring(7),\r\n        createdAt: new Date(),\r\n      }\r\n      return {\r\n        playlists: [...state.playlists, newPlaylist],\r\n      }\r\n    }),\r\n\r\n  deletePlaylist: (id) =>\r\n    set((state) => ({\r\n      playlists: state.playlists.filter((p) => p.id !== id),\r\n      currentPlaylist: state.currentPlaylist === id ? undefined : state.currentPlaylist,\r\n    })),\r\n\r\n  setCurrentPlaylist: (id) =>\r\n    set({\r\n      currentPlaylist: id,\r\n    }),\r\n\r\n  generateWeeklyReport: () => {\r\n    const state = get()\r\n    const today = new Date()\r\n    const weekStart = new Date(today)\r\n    weekStart.setDate(today.getDate() - today.getDay())\r\n\r\n    const weekTasks = state.tasks.filter((t) => {\r\n      const taskDate = new Date(t.createdAt)\r\n      return taskDate >= weekStart && taskDate <= today\r\n    })\r\n\r\n    const weekSessions = state.focusSessions.filter((s) => {\r\n      const sessionDate = new Date(s.date)\r\n      return sessionDate >= weekStart && sessionDate <= today\r\n    })\r\n\r\n    const summary = `Weekly Report (${weekStart.toLocaleDateString()} - ${today.toLocaleDateString()})\r\n    \r\nFocus Sessions: ${weekSessions.length}\r\nTotal Focus Time: ${weekSessions.reduce((sum, s) => sum + s.duration, 0)} minutes\r\nTasks Completed: ${weekTasks.filter((t) => t.completed).length} / ${weekTasks.length}\r\nHabits Maintained: ${state.habits.filter((h) => h.currentStreak > 0).length}\r\nGoals Progress: ${state.goals.filter((g) => g.status === \"active\").length} active goals\r\nDistractions: ${state.distractions.filter((d) => {\r\n      const dDate = new Date(d.date)\r\n      return dDate >= weekStart && dDate <= today\r\n    }).length}`\r\n\r\n    return {\r\n      summary,\r\n      data: {\r\n        focusSessions: weekSessions.length,\r\n        focusTime: weekSessions.reduce((sum, s) => sum + s.duration, 0),\r\n        tasksCompleted: weekTasks.filter((t) => t.completed).length,\r\n        tasksTotal: weekTasks.length,\r\n        habitsActive: state.habits.filter((h) => h.currentStreak > 0).length,\r\n        goalsActive: state.goals.filter((g) => g.status === \"active\").length,\r\n        distractions: state.distractions.filter((d) => {\r\n          const dDate = new Date(d.date)\r\n          return dDate >= weekStart && dDate <= today\r\n        }).length,\r\n      },\r\n    }\r\n  },\r\n\r\n  generateMonthlyReport: () => {\r\n    const state = get()\r\n    const today = new Date()\r\n    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1)\r\n\r\n    const monthTasks = state.tasks.filter((t) => {\r\n      const taskDate = new Date(t.createdAt)\r\n      return taskDate >= monthStart && taskDate <= today\r\n    })\r\n\r\n    const monthSessions = state.focusSessions.filter((s) => {\r\n      const sessionDate = new Date(s.date)\r\n      return sessionDate >= monthStart && sessionDate <= today\r\n    })\r\n\r\n    const summary = `Monthly Report (${monthStart.toLocaleDateString()} - ${today.toLocaleDateString()})\r\n    \r\nFocus Sessions: ${monthSessions.length}\r\nTotal Focus Time: ${Math.round(monthSessions.reduce((sum, s) => sum + s.duration, 0) / 60)} hours\r\nTasks Completed: ${monthTasks.filter((t) => t.completed).length} / ${monthTasks.length}\r\nHabits Maintained: ${state.habits.filter((h) => h.currentStreak > 0).length}\r\nGoals Completed: ${state.goals.filter((g) => g.status === \"completed\").length}\r\nAchievements Unlocked: ${state.achievements.filter((a) => a.unlockedAt).length}\r\nChallenges Completed: ${state.challenges.filter((c) => c.completed).length}`\r\n\r\n    return {\r\n      summary,\r\n      data: {\r\n        focusSessions: monthSessions.length,\r\n        focusTime: Math.round(monthSessions.reduce((sum, s) => sum + s.duration, 0) / 60),\r\n        tasksCompleted: monthTasks.filter((t) => t.completed).length,\r\n        tasksTotal: monthTasks.length,\r\n        habitsActive: state.habits.filter((h) => h.currentStreak > 0).length,\r\n        goalsCompleted: state.goals.filter((g) => g.status === \"completed\").length,\r\n        achievements: state.achievements.filter((a) => a.unlockedAt).length,\r\n        challengesCompleted: state.challenges.filter((c) => c.completed).length,\r\n      },\r\n    }\r\n  },\r\n\r\n  exportToCSV: () => {\r\n    const state = get()\r\n    const headers = [\"Date\", \"Focus Sessions\", \"Tasks Completed\", \"Habits Streak\", \"Goals Progress\"]\r\n    const rows: string[] = []\r\n\r\n    // Group by date\r\n    const dateMap: Record<string, any> = {}\r\n    state.focusSessions.forEach((s) => {\r\n      const date = new Date(s.date).toISOString().split(\"T\")[0]\r\n      if (!dateMap[date]) dateMap[date] = { date, focusSessions: 0, tasks: 0, habits: 0, goals: 0 }\r\n      dateMap[date].focusSessions++\r\n    })\r\n\r\n    state.tasks.filter((t) => t.completed).forEach((t) => {\r\n      const date = new Date(t.createdAt).toISOString().split(\"T\")[0]\r\n      if (!dateMap[date]) dateMap[date] = { date, focusSessions: 0, tasks: 0, habits: 0, goals: 0 }\r\n      dateMap[date].tasks++\r\n    })\r\n\r\n    Object.values(dateMap).forEach((row) => {\r\n      rows.push(`${row.date},${row.focusSessions},${row.tasks},${row.habits},${row.goals}`)\r\n    })\r\n\r\n    return [headers.join(\",\"), ...rows].join(\"\\n\")\r\n  },\r\n\r\n  exportToPDF: () => {\r\n    // In a real app, this would use a PDF library like jsPDF\r\n    // For now, we'll create a downloadable text file\r\n    const state = get()\r\n    const weeklyReport = state.generateWeeklyReport()\r\n    const monthlyReport = state.generateMonthlyReport()\r\n\r\n    const content = `PULSE PRODUCTIVITY REPORT\r\nGenerated: ${new Date().toLocaleDateString()}\r\n\r\n${weeklyReport.summary}\r\n\r\n${monthlyReport.summary}\r\n\r\n---\r\nFor detailed analytics, visit the Analytics dashboard.\r\n`\r\n\r\n    const blob = new Blob([content], { type: \"text/plain\" })\r\n    const url = URL.createObjectURL(blob)\r\n    const a = document.createElement(\"a\")\r\n    a.href = url\r\n    a.download = `pulse-report-${new Date().toISOString().split(\"T\")[0]}.txt`\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    document.body.removeChild(a)\r\n    URL.revokeObjectURL(url)\r\n  },\r\n\r\n  addTeamMember: (member) =>\r\n    set((state) => {\r\n      const newMember: TeamMember = {\r\n        ...member,\r\n        id: Math.random().toString(36).substring(7),\r\n        joinedAt: new Date(),\r\n      }\r\n      return {\r\n        teamMembers: [...state.teamMembers, newMember],\r\n      }\r\n    }),\r\n\r\n  shareGoal: (goalId, memberIds) =>\r\n    set((state) => {\r\n      const existingShare = state.sharedGoals.find((sg) => sg.goalId === goalId)\r\n      if (existingShare) {\r\n        return {\r\n          sharedGoals: state.sharedGoals.map((sg) =>\r\n            sg.goalId === goalId\r\n              ? {\r\n                  ...sg,\r\n                  sharedWith: [...new Set([...sg.sharedWith, ...memberIds])],\r\n                }\r\n              : sg\r\n          ),\r\n        }\r\n      }\r\n      const newShare: SharedGoal = {\r\n        id: Math.random().toString(36).substring(7),\r\n        goalId,\r\n        sharedWith: memberIds,\r\n        sharedAt: new Date(),\r\n      }\r\n      return {\r\n        sharedGoals: [...state.sharedGoals, newShare],\r\n      }\r\n    }),\r\n\r\n  createGroupChallenge: (challenge) =>\r\n    set((state) => {\r\n      const newChallenge: GroupChallenge = {\r\n        ...challenge,\r\n        id: Math.random().toString(36).substring(7),\r\n        leaderboard: challenge.participants.map((userId) => ({ userId, score: 0 })),\r\n      }\r\n      return {\r\n        groupChallenges: [...state.groupChallenges, newChallenge],\r\n      }\r\n    }),\r\n\r\n  getTeamProductivityInsights: () => {\r\n    const state = get()\r\n    // Simulated team data - in real app, this would aggregate from all team members\r\n    const totalFocusTime = state.focusSessions.reduce((sum, s) => sum + s.duration, 0)\r\n    const totalTasks = state.tasks.length\r\n    const averageProgress = state.goals.length > 0 ? state.goals.reduce((sum, g) => sum + g.progress, 0) / state.goals.length : 0\r\n\r\n    return {\r\n      totalFocusTime,\r\n      totalTasks,\r\n      averageProgress: Math.round(averageProgress),\r\n    }\r\n  },\r\n\r\n  addNotification: (notification) =>\r\n    set((state) => {\r\n      const newNotification: Notification = {\r\n        ...notification,\r\n        id: Math.random().toString(36).substring(7),\r\n        timestamp: new Date(),\r\n        read: false,\r\n      }\r\n      return {\r\n        notifications: [newNotification, ...state.notifications],\r\n      }\r\n    }),\r\n\r\n  markNotificationRead: (id) =>\r\n    set((state) => ({\r\n      notifications: state.notifications.map((n) => (n.id === id ? { ...n, read: true } : n)),\r\n    })),\r\n\r\n  clearNotifications: () =>\r\n    set({\r\n      notifications: [],\r\n    }),\r\n\r\n  getUnreadNotifications: () => {\r\n    const state = get()\r\n    return state.notifications.filter((n) => !n.read)\r\n  },\r\n\r\n  checkSmartNotifications: () => {\r\n    const state = get()\r\n    const now = new Date()\r\n    const todayStr = now.toISOString().split(\"T\")[0]\r\n    const lastSession = state.focusSessions[state.focusSessions.length - 1]\r\n\r\n    // Break suggestion - if last session was more than 25 minutes ago and no break taken\r\n    if (lastSession) {\r\n      const sessionTime = new Date(lastSession.date).getTime()\r\n      const timeSinceSession = (now.getTime() - sessionTime) / (1000 * 60) // minutes\r\n      if (timeSinceSession >= 25 && timeSinceSession < 30) {\r\n        const hasRecentBreak = state.distractions.some((d) => {\r\n          const distTime = new Date(d.date).getTime()\r\n          return distTime > sessionTime && d.type === \"other\" && d.source.toLowerCase().includes(\"break\")\r\n        })\r\n        if (!hasRecentBreak) {\r\n          state.addNotification({\r\n            type: \"suggestion\",\r\n            title: \"Time for a Break!\",\r\n            message: \"You've been focusing for a while. Take a 5-minute break to recharge.\",\r\n            actionUrl: \"/dashboard\",\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    // Goal milestone celebration\r\n    state.goals.forEach((goal) => {\r\n      const recentMilestones = goal.milestones.filter((m) => {\r\n        if (!m.completedDate) return false\r\n        const completedTime = new Date(m.completedDate).getTime()\r\n        return now.getTime() - completedTime < 60000 // Within last minute\r\n      })\r\n      if (recentMilestones.length > 0) {\r\n        state.addNotification({\r\n          type: \"celebration\",\r\n          title: \"Milestone Achieved! ðŸŽ‰\",\r\n          message: `You completed \"${recentMilestones[0].title}\" for \"${goal.title}\"`,\r\n          actionUrl: \"/goals\",\r\n        })\r\n      }\r\n    })\r\n\r\n    // Context-aware reminders\r\n    const todayTasks = state.tasks.filter((t) => {\r\n      if (t.completed) return false\r\n      const taskDate = new Date(t.createdAt)\r\n      return taskDate.toDateString() === now.toDateString()\r\n    })\r\n    if (todayTasks.length > 0 && now.getHours() === 9 && now.getMinutes() < 5) {\r\n      state.addNotification({\r\n        type: \"reminder\",\r\n        title: \"Good Morning!\",\r\n        message: `You have ${todayTasks.length} task${todayTasks.length > 1 ? \"s\" : \"\"} to complete today.`,\r\n        actionUrl: \"/tasks\",\r\n      })\r\n    }\r\n\r\n    // Habit reminders - check for habits due soon or overdue\r\n    const currentHour = now.getHours()\r\n    const currentMinute = now.getMinutes()\r\n    \r\n    state.habits.forEach((habit) => {\r\n      // Skip if not auto-scheduled or already completed today\r\n      if (habit.autoSchedule === false) return\r\n      if (habit.completedDates.includes(todayStr)) return\r\n      \r\n      // Determine if habit is due now based on preferred time\r\n      let isDue = false\r\n      let isOverdue = false\r\n      let timeWindowMessage = \"\"\r\n      \r\n      if (habit.scheduledTime) {\r\n        // Use AI-scheduled time\r\n        const [schedHour, schedMinute] = habit.scheduledTime.split(\":\").map(Number)\r\n        const minutesUntil = (schedHour * 60 + schedMinute) - (currentHour * 60 + currentMinute)\r\n        \r\n        if (minutesUntil <= 5 && minutesUntil >= 0) {\r\n          isDue = true\r\n          timeWindowMessage = \"starting now\"\r\n        } else if (minutesUntil < 0 && minutesUntil > -60) {\r\n          isOverdue = true\r\n          timeWindowMessage = `${Math.abs(minutesUntil)} min overdue`\r\n        }\r\n      } else if (habit.preferredTime) {\r\n        // Use preferred time windows\r\n        const timeWindows = {\r\n          morning: { start: 6, end: 11, label: \"morning\" },\r\n          afternoon: { start: 12, end: 17, label: \"afternoon\" },\r\n          evening: { start: 18, end: 22, label: \"evening\" },\r\n        }\r\n        \r\n        const window = timeWindows[habit.preferredTime as keyof typeof timeWindows]\r\n        if (window) {\r\n          // Remind 5 minutes before window starts\r\n          if (currentHour === window.start && currentMinute <= 5) {\r\n            isDue = true\r\n            timeWindowMessage = `${window.label} window starting`\r\n          }\r\n          // Overdue if past window end\r\n          else if (currentHour >= window.end) {\r\n            isOverdue = true\r\n            timeWindowMessage = `${window.label} window passed`\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Check if we already sent a notification for this habit recently\r\n      const recentHabitNotification = state.notifications.some((n) => {\r\n        const notifTime = new Date(n.timestamp).getTime()\r\n        return (\r\n          n.title.includes(habit.name) &&\r\n          now.getTime() - notifTime < 30 * 60 * 1000 // Within last 30 minutes\r\n        )\r\n      })\r\n      \r\n      if (isDue && !recentHabitNotification) {\r\n        const categoryEmoji = habit.category === \"health\" ? \"ðŸ’ª\" \r\n          : habit.category === \"learning\" ? \"ðŸ“š\"\r\n          : habit.category === \"mindfulness\" ? \"ðŸ§˜\"\r\n          : habit.category === \"productivity\" ? \"âš¡\"\r\n          : habit.category === \"social\" ? \"ðŸ‘¥\" : \"âœ¨\"\r\n          \r\n        state.addNotification({\r\n          type: \"reminder\",\r\n          title: `${categoryEmoji} Time for ${habit.name}!`,\r\n          message: habit.currentStreak > 0 \r\n            ? `Keep your ${habit.currentStreak}-day streak going! (${timeWindowMessage})`\r\n            : `${habit.duration || 15} minutes - ${timeWindowMessage}`,\r\n          actionUrl: \"/habits\",\r\n        })\r\n      } else if (isOverdue && !recentHabitNotification) {\r\n        state.addNotification({\r\n          type: \"suggestion\",\r\n          title: `Don't forget: ${habit.name}`,\r\n          message: habit.currentStreak > 0\r\n            ? `âš ï¸ Your ${habit.currentStreak}-day streak is at risk! (${timeWindowMessage})`\r\n            : `You still have time to complete this habit. (${timeWindowMessage})`,\r\n          actionUrl: \"/habits\",\r\n        })\r\n      }\r\n    })\r\n\r\n    // Celebrate habit completion streaks\r\n    state.habits.forEach((habit) => {\r\n      const justCompleted = habit.completedDates.includes(todayStr)\r\n      const streakMilestones = [7, 14, 21, 30, 60, 90, 100, 365]\r\n      \r\n      if (justCompleted && streakMilestones.includes(habit.currentStreak)) {\r\n        const recentStreakNotif = state.notifications.some((n) => {\r\n          const notifTime = new Date(n.timestamp).getTime()\r\n          return (\r\n            n.title.includes(\"Streak\") &&\r\n            n.title.includes(habit.name) &&\r\n            now.getTime() - notifTime < 24 * 60 * 60 * 1000 // Within last 24 hours\r\n          )\r\n        })\r\n        \r\n        if (!recentStreakNotif) {\r\n          state.addNotification({\r\n            type: \"celebration\",\r\n            title: `ðŸ”¥ ${habit.currentStreak}-Day Streak!`,\r\n            message: `Amazing! You've maintained \"${habit.name}\" for ${habit.currentStreak} days in a row!`,\r\n            actionUrl: \"/habits\",\r\n          })\r\n        }\r\n      }\r\n    })\r\n  },\r\n\r\n  setVoiceActive: (active) =>\r\n    set({\r\n      isVoiceActive: active,\r\n    }),\r\n\r\n  processVoiceCommand: (command) => {\r\n    const state = get()\r\n    const lowerCommand = command.toLowerCase().trim()\r\n\r\n    // Task capture\r\n    if (lowerCommand.includes(\"add task\") || lowerCommand.includes(\"create task\") || lowerCommand.includes(\"new task\")) {\r\n      const taskText = command.replace(/add task|create task|new task/gi, \"\").trim()\r\n      if (taskText) {\r\n        state.addTask({\r\n          title: taskText,\r\n          priority: \"medium\",\r\n          timeEstimate: 30,\r\n        })\r\n        state.addNotification({\r\n          type: \"reminder\",\r\n          title: \"Task Added\",\r\n          message: `\"${taskText}\" has been added to your tasks.`,\r\n        })\r\n      }\r\n    }\r\n\r\n    // Start focus session\r\n    if (lowerCommand.includes(\"start focus\") || lowerCommand.includes(\"begin focus\") || lowerCommand.includes(\"focus session\")) {\r\n      const duration = 25 // Default\r\n      state.addFocusSession(duration)\r\n      state.addNotification({\r\n        type: \"reminder\",\r\n        title: \"Focus Session Started\",\r\n        message: `Started a ${duration}-minute focus session.`,\r\n      })\r\n    }\r\n\r\n    // Log mood\r\n    if (lowerCommand.includes(\"mood\") || lowerCommand.includes(\"feeling\")) {\r\n      let mood: \"excellent\" | \"good\" | \"neutral\" | \"sad\" | \"very-sad\" = \"neutral\"\r\n      if (lowerCommand.includes(\"excellent\") || lowerCommand.includes(\"great\") || lowerCommand.includes(\"amazing\")) {\r\n        mood = \"excellent\"\r\n      } else if (lowerCommand.includes(\"good\") || lowerCommand.includes(\"fine\") || lowerCommand.includes(\"okay\")) {\r\n        mood = \"good\"\r\n      } else if (lowerCommand.includes(\"sad\") || lowerCommand.includes(\"bad\") || lowerCommand.includes(\"terrible\")) {\r\n        mood = \"sad\"\r\n      } else if (lowerCommand.includes(\"very sad\") || lowerCommand.includes(\"awful\")) {\r\n        mood = \"very-sad\"\r\n      }\r\n      const notes = command.replace(/mood|feeling/gi, \"\").trim()\r\n      state.addMoodEntry(mood, notes || \"\")\r\n      state.addNotification({\r\n        type: \"reminder\",\r\n        title: \"Mood Logged\",\r\n        message: `Your mood has been recorded as \"${mood}\".`,\r\n      })\r\n    }\r\n  },\r\n\r\n  // Add auth actions\r\n  setAuth: (isAuthenticated, userEmail = \"\") =>\r\n    set({\r\n      auth: {\r\n        isAuthenticated,\r\n        userEmail,\r\n      },\r\n    }),\r\n\r\n  logout: async () => {\r\n    try {\r\n      const api = await import(\"./api\")\r\n      api.authAPI.logout()\r\n    } catch (error) {\r\n      console.error(\"Error during logout:\", error)\r\n    }\r\n    set({\r\n      auth: {\r\n        isAuthenticated: false,\r\n        userEmail: \"\",\r\n      },\r\n      tasks: [],\r\n      habits: [],\r\n      goals: [],\r\n      focusSessions: [],\r\n      distractions: [],\r\n      challenges: [],\r\n      timeBlocks: [],\r\n      notifications: [],\r\n      currentAIPlan: null,\r\n      userAIProfile: null,\r\n      aiPlanLoading: false,\r\n      aiPlanError: null,\r\n    })\r\n  },\r\n\r\n  // AI Features - Actions\r\n  setCurrentAIPlan: (plan) => set({ currentAIPlan: plan }),\r\n  \r\n  setUserAIProfile: (profile) => set({ userAIProfile: profile }),\r\n  \r\n  setAIPlanLoading: (loading) => set({ aiPlanLoading: loading }),\r\n  \r\n  setAIPlanError: (error) => set({ aiPlanError: error }),\r\n\r\n  acceptAIPlan: async () => {\r\n    const state = get()\r\n    if (!state.currentAIPlan) return\r\n    \r\n    try {\r\n      const api = await import(\"./api\")\r\n      await api.aiAPI.acceptPlan(state.currentAIPlan.id)\r\n      \r\n      set({\r\n        currentAIPlan: {\r\n          ...state.currentAIPlan,\r\n          status: \"accepted\",\r\n        },\r\n      })\r\n      \r\n      // Also accept schedule to history\r\n      state.acceptSchedule()\r\n    } catch (error) {\r\n      console.error(\"Failed to accept AI plan:\", error)\r\n      set({ aiPlanError: \"Failed to accept plan\" })\r\n    }\r\n  },\r\n\r\n  rejectAIPlan: async () => {\r\n    const state = get()\r\n    if (!state.currentAIPlan) return\r\n    \r\n    try {\r\n      const api = await import(\"./api\")\r\n      await api.aiAPI.rejectPlan(state.currentAIPlan.id)\r\n      \r\n      set({\r\n        currentAIPlan: {\r\n          ...state.currentAIPlan,\r\n          status: \"rejected\",\r\n        },\r\n      })\r\n    } catch (error) {\r\n      console.error(\"Failed to reject AI plan:\", error)\r\n      set({ aiPlanError: \"Failed to reject plan\" })\r\n    }\r\n  },\r\n}))\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1526, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\r\n\r\n// Create browser client that stores session in cookies (required for SSR auth)\r\nexport const supabase = createBrowserClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n)\r\n"],"names":[],"mappings":";;;;AAIE;AAJF;AAAA;;AAGO,MAAM,WAAW,IAAA,oMAAmB"}},
    {"offset": {"line": 1542, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/lib/api.ts"],"sourcesContent":["import { supabase } from \"./supabase/client\"\r\nimport type { Database } from \"./supabase/types\"\r\n\r\n// Helper function to handle Supabase errors\r\nfunction handleSupabaseError(error: any): never {\r\n  console.error(\"Supabase error:\", error)\r\n  throw new Error(error.message || \"An error occurred\")\r\n}\r\n\r\n// Auth API\r\nexport const authAPI = {\r\n  async login(email: string, password: string): Promise<void> {\r\n    const { data, error } = await supabase.auth.signInWithPassword({\r\n      email,\r\n      password,\r\n    })\r\n\r\n    if (error) {\r\n      throw new Error(error.message || \"Login failed\")\r\n    }\r\n\r\n    // Session is automatically stored by Supabase client\r\n    if (!data.session) {\r\n      throw new Error(\"No session returned\")\r\n    }\r\n  },\r\n\r\n  async register(email: string, name: string, password: string): Promise<void> {\r\n    // Trim and normalize email\r\n    const normalizedEmail = email.trim().toLowerCase()\r\n    \r\n    const { data, error } = await supabase.auth.signUp({\r\n      email: normalizedEmail,\r\n      password,\r\n      options: {\r\n        data: {\r\n          name,\r\n        },\r\n      },\r\n    })\r\n\r\n    if (error) {\r\n      // Provide more helpful error messages\r\n      const errorMsg = error.message.toLowerCase()\r\n      \r\n      // Check for common Supabase error codes\r\n      if (error.status === 422 || errorMsg.includes(\"already registered\") || errorMsg.includes(\"already exists\") || errorMsg.includes(\"user already registered\")) {\r\n        throw new Error(\"This email is already registered. Please try logging in instead.\")\r\n      } else if (errorMsg.includes(\"invalid\") && errorMsg.includes(\"email\")) {\r\n        // Check if it's actually an \"already exists\" error disguised as invalid\r\n        if (errorMsg.includes(\"yawar@gmail.com\") || errorMsg.includes(\"already\")) {\r\n          throw new Error(\"This email is already registered. Please try logging in instead.\")\r\n        }\r\n        throw new Error(\"Please check your email format. Make sure it's a valid email address.\")\r\n      } else {\r\n        // Pass through the original error message\r\n        throw new Error(error.message || \"Registration failed. Please try again.\")\r\n      }\r\n    }\r\n\r\n    // Email confirmation is disabled - user should be immediately signed in\r\n    if (!data.user) {\r\n      throw new Error(\"Failed to create user account. Please try again.\")\r\n    }\r\n\r\n    // If no session was returned, try to sign in immediately\r\n    if (!data.session) {\r\n      // Try to sign in with the same credentials to get a session\r\n      const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({\r\n        email: normalizedEmail,\r\n        password: password,\r\n      })\r\n\r\n      if (signInError || !signInData.session) {\r\n        // If sign in fails, it might be because email confirmation is still enabled\r\n        console.error(\"Signup session error:\", signInError)\r\n        throw new Error(\"Account created but failed to sign in. Please try logging in manually. If this persists, check that email confirmation is disabled in Supabase settings.\")\r\n      }\r\n    }\r\n    \r\n    // Wait a bit for the user profile to be created by the trigger\r\n    await new Promise(resolve => setTimeout(resolve, 500))\r\n    \r\n    // Update user profile with name\r\n    const { error: updateError } = await supabase\r\n      .from(\"users\")\r\n      .update({ name })\r\n      .eq(\"id\", data.user.id)\r\n\r\n    if (updateError) {\r\n      console.error(\"Failed to update user name:\", updateError)\r\n      // Don't throw - profile might not exist yet, it will be created by trigger\r\n    }\r\n  },\r\n\r\n  logout(): void {\r\n    supabase.auth.signOut()\r\n  },\r\n}\r\n\r\n// Users API\r\nexport const usersAPI = {\r\n  async getCurrentUser(): Promise<{ email: string; name: string; onboarding_completed: boolean }> {\r\n    // First check session\r\n    const { data: { session }, error: sessionError } = await supabase.auth.getSession()\r\n    \r\n    if (sessionError || !session) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const user = session.user\r\n\r\n    // Try to get user profile, but handle case where it might not exist yet\r\n    const { data, error } = await supabase\r\n      .from(\"users\")\r\n      .select(\"email, name, onboarding_completed\")\r\n      .eq(\"id\", user.id)\r\n      .single()\r\n\r\n    // If user profile doesn't exist yet, create it\r\n    if (error && error.code === 'PGRST116') {\r\n      // Profile doesn't exist, create it\r\n      const { error: insertError } = await supabase\r\n        .from(\"users\")\r\n        .insert({\r\n          id: user.id,\r\n          email: user.email || \"\",\r\n          name: user.user_metadata?.name || null,\r\n          onboarding_completed: false,\r\n        })\r\n\r\n      if (insertError) {\r\n        console.error(\"Failed to create user profile:\", insertError)\r\n      }\r\n\r\n      return {\r\n        email: user.email || \"\",\r\n        name: user.user_metadata?.name || \"\",\r\n        onboarding_completed: false,\r\n      }\r\n    }\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return {\r\n      email: data?.email || user.email || \"\",\r\n      name: data?.name || \"\",\r\n      onboarding_completed: data?.onboarding_completed || false,\r\n    }\r\n  },\r\n\r\n  async updateCurrentUser(data: { onboarding_completed?: boolean; name?: string }): Promise<void> {\r\n    // Check session first\r\n    const { data: { session }, error: sessionError } = await supabase.auth.getSession()\r\n    \r\n    if (sessionError || !session) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const user = session.user\r\n\r\n    const updates: any = {}\r\n    if (data.onboarding_completed !== undefined) {\r\n      updates.onboarding_completed = data.onboarding_completed\r\n    }\r\n    if (data.name !== undefined) {\r\n      updates.name = data.name\r\n    }\r\n\r\n    const { error } = await supabase.from(\"users\").update(updates).eq(\"id\", user.id)\r\n\r\n    if (error) {\r\n      // If user profile doesn't exist, create it first\r\n      if (error.code === 'PGRST116') {\r\n        const { error: insertError } = await supabase\r\n          .from(\"users\")\r\n          .insert({\r\n            id: user.id,\r\n            email: user.email || \"\",\r\n            name: data.name || user.user_metadata?.name || null,\r\n            onboarding_completed: data.onboarding_completed || false,\r\n          })\r\n\r\n        if (insertError) {\r\n          handleSupabaseError(insertError)\r\n        }\r\n      } else {\r\n        handleSupabaseError(error)\r\n      }\r\n    }\r\n  },\r\n}\r\n\r\n// Tasks API\r\nexport const tasksAPI = {\r\n  async getAll(): Promise<any[]> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tasks\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return (\r\n      data?.map((task) => ({\r\n        id: task.id,\r\n        title: task.title,\r\n        description: task.description || \"\",\r\n        priority: task.priority,\r\n        time_estimate: task.time_estimate,\r\n        completed: task.completed,\r\n        created_at: task.created_at,\r\n        category: task.category,\r\n        due_date: task.due_date,\r\n        focus_mode: task.focus_mode,\r\n      })) || []\r\n    )\r\n  },\r\n\r\n  async getById(id: string): Promise<any> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"tasks\")\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .eq(\"user_id\", user.id)\r\n      .single()\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return {\r\n      id: data.id,\r\n      title: data.title,\r\n      description: data.description || \"\",\r\n      priority: data.priority,\r\n      time_estimate: data.time_estimate,\r\n      completed: data.completed,\r\n      created_at: data.created_at,\r\n      category: data.category,\r\n      due_date: data.due_date,\r\n      focus_mode: data.focus_mode,\r\n    }\r\n  },\r\n\r\n  async create(data: {\r\n    title: string\r\n    description?: string\r\n    priority: \"high\" | \"medium\" | \"low\"\r\n    time_estimate: number\r\n    category?: string\r\n    due_date?: string\r\n    focus_mode?: boolean\r\n  }): Promise<any> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { data: task, error } = await supabase\r\n      .from(\"tasks\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: data.title,\r\n        description: data.description || \"\",\r\n        priority: data.priority,\r\n        time_estimate: data.time_estimate,\r\n        category: data.category || null,\r\n        due_date: data.due_date || null,\r\n        focus_mode: data.focus_mode || false,\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return {\r\n      id: task.id,\r\n      title: task.title,\r\n      description: task.description || \"\",\r\n      priority: task.priority,\r\n      time_estimate: task.time_estimate,\r\n      completed: task.completed,\r\n      created_at: task.created_at,\r\n      category: task.category,\r\n      due_date: task.due_date,\r\n      focus_mode: task.focus_mode,\r\n    }\r\n  },\r\n\r\n  async update(\r\n    id: string,\r\n    data: Partial<{\r\n      title: string\r\n      description: string\r\n      priority: \"high\" | \"medium\" | \"low\"\r\n      time_estimate: number\r\n      category: string\r\n      due_date: string\r\n      focus_mode: boolean\r\n      completed: boolean\r\n    }>\r\n  ): Promise<any> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const updates: any = {}\r\n    if (data.title !== undefined) updates.title = data.title\r\n    if (data.description !== undefined) updates.description = data.description\r\n    if (data.priority !== undefined) updates.priority = data.priority\r\n    if (data.time_estimate !== undefined) updates.time_estimate = data.time_estimate\r\n    if (data.category !== undefined) updates.category = data.category\r\n    if (data.due_date !== undefined) updates.due_date = data.due_date || null\r\n    if (data.focus_mode !== undefined) updates.focus_mode = data.focus_mode\r\n    if (data.completed !== undefined) updates.completed = data.completed\r\n\r\n    const { data: task, error } = await supabase\r\n      .from(\"tasks\")\r\n      .update(updates)\r\n      .eq(\"id\", id)\r\n      .eq(\"user_id\", user.id)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return {\r\n      id: task.id,\r\n      title: task.title,\r\n      description: task.description || \"\",\r\n      priority: task.priority,\r\n      time_estimate: task.time_estimate,\r\n      completed: task.completed,\r\n      created_at: task.created_at,\r\n      category: task.category,\r\n      due_date: task.due_date,\r\n      focus_mode: task.focus_mode,\r\n    }\r\n  },\r\n\r\n  async delete(id: string): Promise<void> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { error } = await supabase.from(\"tasks\").delete().eq(\"id\", id).eq(\"user_id\", user.id)\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n  },\r\n}\r\n\r\n// Focus Sessions API\r\nexport const focusSessionsAPI = {\r\n  async getAll(): Promise<any[]> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"focus_sessions\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return (\r\n      data?.map((session) => ({\r\n        id: session.id,\r\n        duration: session.duration,\r\n        completed: session.completed,\r\n        created_at: session.created_at,\r\n        date: session.created_at,\r\n      })) || []\r\n    )\r\n  },\r\n\r\n  async create(data: { duration: number; completed: boolean }): Promise<any> {\r\n    const {\r\n      data: { user },\r\n    } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      throw new Error(\"Not authenticated\")\r\n    }\r\n\r\n    const { data: session, error } = await supabase\r\n      .from(\"focus_sessions\")\r\n      .insert({\r\n        user_id: user.id,\r\n        duration: data.duration,\r\n        completed: data.completed,\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return {\r\n      id: session.id,\r\n      duration: session.duration,\r\n      completed: session.completed,\r\n      created_at: session.created_at,\r\n      date: session.created_at,\r\n    }\r\n  },\r\n}\r\n\r\n// AI API - Functions for AI-powered features\r\nexport const aiAPI = {\r\n  /**\r\n   * Fetches today's AI-generated plan for the current user.\r\n   */\r\n  async getDailyPlan(date: string): Promise<any | null> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"ai_plans\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .eq(\"plan_date\", date)\r\n      .single()\r\n\r\n    // PGRST116 means no rows found - that's okay, return null\r\n    if (error && error.code !== \"PGRST116\") {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return data || null\r\n  },\r\n\r\n  /**\r\n   * Marks a plan as accepted.\r\n   */\r\n  async acceptPlan(planId: string): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { error } = await supabase\r\n      .from(\"ai_plans\")\r\n      .update({ \r\n        status: \"accepted\", \r\n        accepted_at: new Date().toISOString() \r\n      })\r\n      .eq(\"id\", planId)\r\n      .eq(\"user_id\", user.id)\r\n\r\n    if (error) handleSupabaseError(error)\r\n\r\n    // Log feedback event\r\n    await supabase.from(\"plan_feedback_events\").insert({\r\n      plan_id: planId,\r\n      user_id: user.id,\r\n      event_type: \"accepted\",\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Marks a plan as rejected.\r\n   */\r\n  async rejectPlan(planId: string): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { error } = await supabase\r\n      .from(\"ai_plans\")\r\n      .update({ \r\n        status: \"rejected\", \r\n        rejected_at: new Date().toISOString() \r\n      })\r\n      .eq(\"id\", planId)\r\n      .eq(\"user_id\", user.id)\r\n\r\n    if (error) handleSupabaseError(error)\r\n\r\n    // Log feedback event\r\n    await supabase.from(\"plan_feedback_events\").insert({\r\n      plan_id: planId,\r\n      user_id: user.id,\r\n      event_type: \"rejected\",\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Updates a plan's schedule (when user edits it).\r\n   */\r\n  async updatePlanSchedule(planId: string, newSchedule: any[]): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    // First get current plan to store original\r\n    const { data: plan } = await supabase\r\n      .from(\"ai_plans\")\r\n      .select(\"schedule, edit_count\")\r\n      .eq(\"id\", planId)\r\n      .eq(\"user_id\", user.id)\r\n      .single()\r\n\r\n    const { error } = await supabase\r\n      .from(\"ai_plans\")\r\n      .update({\r\n        schedule: newSchedule,\r\n        original_schedule: plan?.schedule || null,\r\n        status: \"edited\",\r\n        edit_count: (plan?.edit_count || 0) + 1,\r\n        last_edited_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", planId)\r\n      .eq(\"user_id\", user.id)\r\n\r\n    if (error) handleSupabaseError(error)\r\n\r\n    // Log feedback event\r\n    await supabase.from(\"plan_feedback_events\").insert({\r\n      plan_id: planId,\r\n      user_id: user.id,\r\n      event_type: \"edited\",\r\n      event_data: { editCount: (plan?.edit_count || 0) + 1 },\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Logs a feedback event for task completion within a plan.\r\n   */\r\n  async logPlanTaskCompletion(planId: string, taskId: string): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    await supabase.from(\"plan_feedback_events\").insert({\r\n      plan_id: planId,\r\n      user_id: user.id,\r\n      event_type: \"task_completed\",\r\n      event_data: { taskId },\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Fetches recent chat history for the AI coach.\r\n   */\r\n  async getChatHistory(limit: number = 20): Promise<any[]> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"ai_chat_history\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(limit)\r\n\r\n    if (error) handleSupabaseError(error)\r\n\r\n    return data || []\r\n  },\r\n\r\n  /**\r\n   * Saves a chat message to history.\r\n   */\r\n  async saveChatMessage(\r\n    role: \"user\" | \"assistant\",\r\n    message: string,\r\n    context?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { error } = await supabase.from(\"ai_chat_history\").insert({\r\n      user_id: user.id,\r\n      role,\r\n      message,\r\n      context_snapshot: context || null,\r\n    })\r\n\r\n    if (error) handleSupabaseError(error)\r\n  },\r\n\r\n  /**\r\n   * Fetches the user's AI profile (personalization data).\r\n   */\r\n  async getUserAIProfile(): Promise<any | null> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"user_ai_profiles\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .single()\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      handleSupabaseError(error)\r\n    }\r\n\r\n    return data || null\r\n  },\r\n\r\n  /**\r\n   * Fetches recent daily aggregates.\r\n   */\r\n  async getRecentAggregates(days: number = 14): Promise<any[]> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const startDate = new Date()\r\n    startDate.setDate(startDate.getDate() - days)\r\n    const startDateStr = startDate.toISOString().split(\"T\")[0]\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"daily_aggregates\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .gte(\"date\", startDateStr)\r\n      .order(\"date\", { ascending: false })\r\n\r\n    if (error) handleSupabaseError(error)\r\n\r\n    return data || []\r\n  },\r\n\r\n  /**\r\n   * Updates daily rating for a specific date.\r\n   */\r\n  async updateDailyRating(date: string, rating: number): Promise<void> {\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    if (!user) throw new Error(\"Not authenticated\")\r\n\r\n    const clampedRating = Math.max(1, Math.min(10, rating))\r\n\r\n    const { error } = await supabase\r\n      .from(\"daily_aggregates\")\r\n      .upsert(\r\n        {\r\n          user_id: user.id,\r\n          date,\r\n          daily_rating: clampedRating,\r\n        },\r\n        { onConflict: \"user_id,date\" }\r\n      )\r\n\r\n    if (error) handleSupabaseError(error)\r\n  },\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2026, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/lib/store-sync.ts"],"sourcesContent":["import { useStore } from \"./store\"\r\nimport { tasksAPI, focusSessionsAPI, aiAPI } from \"./api\"\r\n\r\n/**\r\n * Syncs the local Zustand store with the Supabase backend\r\n * This function fetches data from Supabase and updates the store\r\n */\r\nexport async function syncStoreWithAPI(): Promise<void> {\r\n  try {\r\n    // Sync tasks\r\n    try {\r\n      const tasks = await tasksAPI.getAll()\r\n      const mappedTasks = tasks.map((task: any) => ({\r\n        id: task.id,\r\n        title: task.title,\r\n        description: task.description || \"\",\r\n        priority: task.priority,\r\n        timeEstimate: task.time_estimate || 30,\r\n        completed: task.completed || false,\r\n        createdAt: new Date(task.created_at),\r\n        category: task.category,\r\n        dueDate: task.due_date ? new Date(task.due_date).toISOString().split(\"T\")[0] : undefined,\r\n        focusMode: task.focus_mode || false,\r\n      }))\r\n\r\n      // Update store with synced tasks\r\n      useStore.setState({ tasks: mappedTasks })\r\n    } catch (error) {\r\n      console.error(\"Failed to sync tasks:\", error)\r\n    }\r\n\r\n    // Sync focus sessions\r\n    try {\r\n      const sessions = await focusSessionsAPI.getAll()\r\n      const mappedSessions = sessions.map((session: any) => ({\r\n        id: session.id,\r\n        duration: session.duration,\r\n        date: new Date(session.created_at || session.date),\r\n        completed: session.completed || false,\r\n      }))\r\n\r\n      useStore.setState({ focusSessions: mappedSessions })\r\n    } catch (error) {\r\n      console.error(\"Failed to sync focus sessions:\", error)\r\n    }\r\n\r\n    // Sync AI plan\r\n    try {\r\n      await syncAIPlan()\r\n    } catch (error) {\r\n      console.error(\"Failed to sync AI plan:\", error)\r\n    }\r\n\r\n    // Sync AI profile\r\n    try {\r\n      await syncAIProfile()\r\n    } catch (error) {\r\n      console.error(\"Failed to sync AI profile:\", error)\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Failed to sync store with API:\", error)\r\n    // Don't throw - allow app to continue with local state\r\n  }\r\n}\r\n\r\n/**\r\n * Syncs today's AI plan from the database to the store\r\n */\r\nexport async function syncAIPlan(): Promise<void> {\r\n  try {\r\n    useStore.setState({ aiPlanLoading: true, aiPlanError: null })\r\n    \r\n    const today = new Date().toISOString().split(\"T\")[0]\r\n    const plan = await aiAPI.getDailyPlan(today)\r\n    \r\n    if (plan) {\r\n      useStore.setState({ \r\n        currentAIPlan: plan,\r\n        currentSchedule: plan.schedule || [],\r\n      })\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Failed to sync AI plan:\", error)\r\n    useStore.setState({ aiPlanError: \"Failed to load AI plan\" })\r\n  } finally {\r\n    useStore.setState({ aiPlanLoading: false })\r\n  }\r\n}\r\n\r\n/**\r\n * Syncs the user's AI profile from the database to the store\r\n */\r\nexport async function syncAIProfile(): Promise<void> {\r\n  try {\r\n    const profile = await aiAPI.getUserAIProfile()\r\n    \r\n    if (profile) {\r\n      useStore.setState({ \r\n        userAIProfile: {\r\n          optimal_focus_duration: profile.optimal_focus_duration,\r\n          preferred_work_start_hour: profile.preferred_work_start_hour,\r\n          preferred_work_end_hour: profile.preferred_work_end_hour,\r\n          most_productive_hours: profile.most_productive_hours || [],\r\n          avg_plan_acceptance_rate: profile.avg_plan_acceptance_rate || 0,\r\n        }\r\n      })\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Failed to sync AI profile:\", error)\r\n    // Non-critical - continue without profile\r\n  }\r\n}\r\n\r\n/**\r\n * Manually triggers a new AI plan generation and syncs it to the store\r\n */\r\nexport async function regenerateAIPlan(): Promise<void> {\r\n  try {\r\n    useStore.setState({ aiPlanLoading: true, aiPlanError: null })\r\n    \r\n    const response = await fetch(\"/api/ai/generate-plan\", { method: \"POST\" })\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(\"Failed to generate plan\")\r\n    }\r\n    \r\n    const data = await response.json()\r\n    \r\n    if (data.plan) {\r\n      useStore.setState({ \r\n        currentAIPlan: data.plan,\r\n        currentSchedule: data.plan.schedule || [],\r\n      })\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Failed to regenerate AI plan:\", error)\r\n    useStore.setState({ aiPlanError: \"Failed to generate new plan\" })\r\n  } finally {\r\n    useStore.setState({ aiPlanLoading: false })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAMO,eAAe;IACpB,IAAI;QACF,aAAa;QACb,IAAI;YACF,MAAM,QAAQ,MAAM,yHAAQ,CAAC,MAAM;YACnC,MAAM,cAAc,MAAM,GAAG,CAAC,CAAC,OAAc,CAAC;oBAC5C,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,aAAa,KAAK,WAAW,IAAI;oBACjC,UAAU,KAAK,QAAQ;oBACvB,cAAc,KAAK,aAAa,IAAI;oBACpC,WAAW,KAAK,SAAS,IAAI;oBAC7B,WAAW,IAAI,KAAK,KAAK,UAAU;oBACnC,UAAU,KAAK,QAAQ;oBACvB,SAAS,KAAK,QAAQ,GAAG,IAAI,KAAK,KAAK,QAAQ,EAAE,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;oBAC/E,WAAW,KAAK,UAAU,IAAI;gBAChC,CAAC;YAED,iCAAiC;YACjC,2HAAQ,CAAC,QAAQ,CAAC;gBAAE,OAAO;YAAY;QACzC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;QACzC;QAEA,sBAAsB;QACtB,IAAI;YACF,MAAM,WAAW,MAAM,iIAAgB,CAAC,MAAM;YAC9C,MAAM,iBAAiB,SAAS,GAAG,CAAC,CAAC,UAAiB,CAAC;oBACrD,IAAI,QAAQ,EAAE;oBACd,UAAU,QAAQ,QAAQ;oBAC1B,MAAM,IAAI,KAAK,QAAQ,UAAU,IAAI,QAAQ,IAAI;oBACjD,WAAW,QAAQ,SAAS,IAAI;gBAClC,CAAC;YAED,2HAAQ,CAAC,QAAQ,CAAC;gBAAE,eAAe;YAAe;QACpD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;QAClD;QAEA,eAAe;QACf,IAAI;YACF,MAAM;QACR,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;QAEA,kBAAkB;QAClB,IAAI;YACF,MAAM;QACR,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8BAA8B;QAC9C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;IAChD,uDAAuD;IACzD;AACF;AAKO,eAAe;IACpB,IAAI;QACF,2HAAQ,CAAC,QAAQ,CAAC;YAAE,eAAe;YAAM,aAAa;QAAK;QAE3D,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACpD,MAAM,OAAO,MAAM,sHAAK,CAAC,YAAY,CAAC;QAEtC,IAAI,MAAM;YACR,2HAAQ,CAAC,QAAQ,CAAC;gBAChB,eAAe;gBACf,iBAAiB,KAAK,QAAQ,IAAI,EAAE;YACtC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,2HAAQ,CAAC,QAAQ,CAAC;YAAE,aAAa;QAAyB;IAC5D,SAAU;QACR,2HAAQ,CAAC,QAAQ,CAAC;YAAE,eAAe;QAAM;IAC3C;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,sHAAK,CAAC,gBAAgB;QAE5C,IAAI,SAAS;YACX,2HAAQ,CAAC,QAAQ,CAAC;gBAChB,eAAe;oBACb,wBAAwB,QAAQ,sBAAsB;oBACtD,2BAA2B,QAAQ,yBAAyB;oBAC5D,yBAAyB,QAAQ,uBAAuB;oBACxD,uBAAuB,QAAQ,qBAAqB,IAAI,EAAE;oBAC1D,0BAA0B,QAAQ,wBAAwB,IAAI;gBAChE;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;IAC5C,0CAA0C;IAC5C;AACF;AAKO,eAAe;IACpB,IAAI;QACF,2HAAQ,CAAC,QAAQ,CAAC;YAAE,eAAe;YAAM,aAAa;QAAK;QAE3D,MAAM,WAAW,MAAM,MAAM,yBAAyB;YAAE,QAAQ;QAAO;QAEvE,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,KAAK,IAAI,EAAE;YACb,2HAAQ,CAAC,QAAQ,CAAC;gBAChB,eAAe,KAAK,IAAI;gBACxB,iBAAiB,KAAK,IAAI,CAAC,QAAQ,IAAI,EAAE;YAC3C;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,2HAAQ,CAAC,QAAQ,CAAC;YAAE,aAAa;QAA8B;IACjE,SAAU;QACR,2HAAQ,CAAC,QAAQ,CAAC;YAAE,eAAe;QAAM;IAC3C;AACF"}},
    {"offset": {"line": 2177, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\r\nimport { twMerge } from \"tailwind-merge\"\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 2195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OGDCL/Downloads/PULSE-AI-PROJECT/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useStore } from \"@/lib/store\"\r\nimport { syncStoreWithAPI } from \"@/lib/store-sync\"\r\nimport { authAPI, usersAPI } from \"@/lib/api\"\r\nimport { supabase } from \"@/lib/supabase/client\"\r\nimport AuthWelcome from \"@/components/auth-welcome\"\r\nimport OnboardingFlow from \"@/components/onboarding-flow\"\r\nimport Dashboard from \"@/components/dashboard\"\r\nimport DayPlanner from \"@/components/day-planner\"\r\nimport AnalyticsDashboard from \"@/components/analytics-dashboard\"\r\nimport SettingsPage from \"@/components/settings-page\"\r\nimport CoachPanel from \"@/components/coach-panel\"\r\nimport Navigation from \"@/components/navigation\"\r\nimport TaskManager from \"@/components/task-manager\"\r\nimport MoodTracker from \"@/components/mood-tracker\"\r\nimport AppHeader from \"@/components/app-header\"\r\nimport BlockingSettings from \"@/components/blocking-settings\"\r\nimport HabitTracker from \"@/components/habit-tracker\"\r\nimport Goals from \"@/components/goals\"\r\nimport DistractionLog from \"@/components/distraction-log\"\r\nimport Challenges from \"@/components/challenges\"\r\nimport TimeBlockCalendar from \"@/components/time-block-calendar\"\r\nimport FocusSounds from \"@/components/focus-sounds\"\r\nimport Reports from \"@/components/reports\"\r\nimport TeamCollaboration from \"@/components/team-collaboration\"\r\nimport SmartNotifications from \"@/components/smart-notifications\"\r\nimport VoiceCommands from \"@/components/voice-commands\"\r\nimport EnergyTracker from \"@/components/energy-tracker\"\r\nimport WeeklyReport from \"@/components/insights/weekly-report\"\r\nimport TaskDecomposer from \"@/components/task-decomposer\"\r\n\r\nexport default function Home() {\r\n  // ALL HOOKS MUST BE CALLED AT THE TOP - BEFORE ANY CONDITIONAL RETURNS\r\n  const { auth, setAuth, currentPage, isMobileMenuOpen, setMobileMenuOpen } = useStore()\r\n  const [isOnboarded, setIsOnboarded] = useState<boolean | null>(null) // null = loading, false = not onboarded, true = onboarded\r\n  const [isCheckingAuth, setIsCheckingAuth] = useState(true) // Track if we're still checking auth\r\n  const [hasSetInitialPage, setHasSetInitialPage] = useState(false) // Track if we've set initial page\r\n\r\n  // Check if user is authenticated on mount\r\n  useEffect(() => {\r\n    let isMounted = true\r\n    \r\n    const checkAuth = async () => {\r\n      setIsCheckingAuth(true)\r\n      \r\n      try {\r\n        // Check Supabase session\r\n        const { data: { session }, error: sessionError } = await supabase.auth.getSession()\r\n        \r\n        if (sessionError || !session) {\r\n          // No session - show login\r\n          if (isMounted) {\r\n            setAuth(false, \"\")\r\n            setIsOnboarded(false)\r\n            setIsCheckingAuth(false)\r\n          }\r\n          return\r\n        }\r\n\r\n        // We have a session - get user info\r\n        try {\r\n          const user = await usersAPI.getCurrentUser() as { email: string; name: string; onboarding_completed: boolean }\r\n          if (isMounted) {\r\n            if (user && user.email) {\r\n              setAuth(true, user.email)\r\n              // Set onboarding status - existing users should have this as true\r\n              const onboardingStatus = user.onboarding_completed === true\r\n              setIsOnboarded(onboardingStatus)\r\n              setIsCheckingAuth(false)\r\n              // Sync data from API (don't wait for it)\r\n              syncStoreWithAPI().catch((syncError) => {\r\n                console.error(\"Failed to sync store:\", syncError)\r\n              })\r\n            } else {\r\n              // User data not found\r\n              setIsOnboarded(false)\r\n              setIsCheckingAuth(false)\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Failed to get user info:\", error)\r\n          if (isMounted) {\r\n            setIsOnboarded(false)\r\n            setIsCheckingAuth(false)\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Auth check error:\", error)\r\n        if (isMounted) {\r\n          // Not authenticated - show login\r\n          setAuth(false, \"\")\r\n          setIsOnboarded(false)\r\n          setIsCheckingAuth(false)\r\n        }\r\n      }\r\n    }\r\n    \r\n    checkAuth()\r\n    \r\n    // Listen for auth state changes\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\r\n      if (!isMounted) return\r\n      \r\n      if (event === 'SIGNED_OUT' || !session) {\r\n        setAuth(false, \"\")\r\n        setIsOnboarded(false)\r\n      } else if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {\r\n        checkAuth()\r\n      }\r\n    })\r\n    \r\n    // Cleanup function\r\n    return () => {\r\n      isMounted = false\r\n      subscription.unsubscribe()\r\n    }\r\n  }, [setAuth]) // Run only on mount\r\n\r\n  // Set initial page to dashboard only once when user first becomes authenticated and onboarded\r\n  useEffect(() => {\r\n    if (auth.isAuthenticated && isOnboarded && !isCheckingAuth && !hasSetInitialPage) {\r\n      const { setCurrentPage, currentPage: storeCurrentPage } = useStore.getState()\r\n      // Only set to dashboard if currentPage is not already set to a valid page\r\n      // This ensures we don't override user navigation\r\n      if (!storeCurrentPage || storeCurrentPage === \"dashboard\") {\r\n        setCurrentPage(\"dashboard\")\r\n      }\r\n      setHasSetInitialPage(true)\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [auth.isAuthenticated, isOnboarded, isCheckingAuth]) // Only depend on auth state, not currentPage\r\n\r\n  // NOW WE CAN DO CONDITIONAL RENDERING AFTER ALL HOOKS\r\n  if (!auth.isAuthenticated) {\r\n    return <AuthWelcome />\r\n  }\r\n\r\n  // Show loading state while checking auth\r\n  if (isCheckingAuth) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\r\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (!isOnboarded) {\r\n    return (\r\n      <OnboardingFlow\r\n        onComplete={async () => {\r\n          try {\r\n            // Wait a bit to ensure session is ready\r\n            await new Promise(resolve => setTimeout(resolve, 300))\r\n            await usersAPI.updateCurrentUser({ onboarding_completed: true })\r\n            setIsOnboarded(true)\r\n            // Ensure we're on dashboard after onboarding\r\n            const { setCurrentPage } = useStore.getState()\r\n            setCurrentPage(\"dashboard\")\r\n          } catch (error) {\r\n            console.error(\"Failed to update onboarding status:\", error)\r\n            // Still proceed even if API call fails - user can complete onboarding later\r\n            setIsOnboarded(true)\r\n            const { setCurrentPage } = useStore.getState()\r\n            setCurrentPage(\"dashboard\")\r\n          }\r\n        }}\r\n      />\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-background\">\r\n      <Navigation\r\n        isMobileOpen={isMobileMenuOpen}\r\n        onMobileClose={() => setMobileMenuOpen(false)}\r\n      />\r\n      <main className=\"flex-1 overflow-auto lg:ml-0 flex flex-col\">\r\n        <AppHeader />\r\n        <div className=\"flex-1 overflow-auto\">\r\n          {currentPage === \"dashboard\" && <Dashboard />}\r\n          {currentPage === \"tasks\" && <TaskManager />}\r\n          {currentPage === \"habits\" && <HabitTracker />}\r\n          {currentPage === \"goals\" && <Goals />}\r\n          {currentPage === \"mood\" && <MoodTracker />}\r\n          {currentPage === \"planner\" && <DayPlanner />}\r\n          {currentPage === \"timeblocks\" && <TimeBlockCalendar />}\r\n          {currentPage === \"analytics\" && <AnalyticsDashboard />}\r\n          {currentPage === \"distractions\" && <DistractionLog />}\r\n          {currentPage === \"challenges\" && <Challenges />}\r\n          {currentPage === \"sounds\" && <FocusSounds />}\r\n          {currentPage === \"reports\" && <Reports />}\r\n          {currentPage === \"team\" && <TeamCollaboration />}\r\n          {currentPage === \"notifications\" && <SmartNotifications />}\r\n          {currentPage === \"voice\" && <VoiceCommands />}\r\n          {currentPage === \"blocking\" && <BlockingSettings />}\r\n          {currentPage === \"settings\" && <SettingsPage />}\r\n          {currentPage === \"coach\" && <CoachPanel />}\r\n          {currentPage === \"energy\" && <EnergyTracker />}\r\n          {currentPage === \"insights\" && <WeeklyReport />}\r\n          {currentPage === \"decomposer\" && <TaskDecomposer />}\r\n        </div>\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}